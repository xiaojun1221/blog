(window.webpackJsonp=window.webpackJsonp||[]).push([[26],{536:function(t,s,n){"use strict";n.r(s);var a=n(3),e=Object(a.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"使用gzip压缩数据传输，及替换feign的通信实现为httpclient"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#使用gzip压缩数据传输，及替换feign的通信实现为httpclient"}},[t._v("#")]),t._v(" 使用gzip压缩数据传输，及替换feign的通信实现为httpclient")]),t._v(" "),n("h2",{attrs:{id:"启用springboot压缩，其在返回响应时，将数据压缩"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#启用springboot压缩，其在返回响应时，将数据压缩"}},[t._v("#")]),t._v(" 启用springboot压缩，其在返回响应时，将数据压缩")]),t._v(" "),n("ul",[n("li",[t._v("修改application-xxx.yml文件，在server代码段中，增加以下配置以开启SpringBoot的压缩")])]),t._v(" "),n("div",{staticClass:"language-yml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("server")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#启用响应压缩")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("compression")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#启用压缩")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("enabled")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mime-types")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" application/json"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("application/xml"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("text/html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("text/xml"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("text/plain\n\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#最小响应数据的大小，当响应数据大于此值时才会压缩(单位B)")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("min-response-size")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2048")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br")])]),n("ul",[n("li",[t._v("使用postman直接请求本地(不走网关和nginx)，如果出现下图，则表示后端gzip压缩配置成功")])]),t._v(" "),n("p",[n("img",{attrs:{src:"/media//202012/gzip%E5%8E%8B%E7%BC%A9_1608279299.png",alt:""}})]),t._v(" "),n("h2",{attrs:{id:"启用feign压缩及解压响应"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#启用feign压缩及解压响应"}},[t._v("#")]),t._v(" 启用feign压缩及解压响应")]),t._v(" "),n("ul",[n("li",[t._v("修改application-xxx.yml文件，在feign代码段，增加以下配置启用httpclient及并且使feign也使用gzip压缩")])]),t._v(" "),n("div",{staticClass:"language-yml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("feign")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hystrix")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#启用熔断器")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("enabled")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#启用feign压缩")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("compression")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("request")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("enabled")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#压缩的Mime类型")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mime-types")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" application/json"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("application/xml"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("text/html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("text/xml"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("text/plain\n      "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#最小请求数据的大小，当请求数据大于此值时才会压缩(单位B)")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("min-request-size")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2048")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#解压响应")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("response")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("enabled")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#使用gzip解压")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("useGzipDecoder")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("httpclient")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#使用httpclient作为实现")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("enabled")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br"),n("span",{staticClass:"line-number"},[t._v("14")]),n("br"),n("span",{staticClass:"line-number"},[t._v("15")]),n("br"),n("span",{staticClass:"line-number"},[t._v("16")]),n("br"),n("span",{staticClass:"line-number"},[t._v("17")]),n("br"),n("span",{staticClass:"line-number"},[t._v("18")]),n("br"),n("span",{staticClass:"line-number"},[t._v("19")]),n("br"),n("span",{staticClass:"line-number"},[t._v("20")]),n("br")])]),n("ul",[n("li",[t._v("修改pom.xml文件，增加feign-httpclient依赖")])]),t._v(" "),n("div",{staticClass:"language-xml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-xml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token entity named-entity",title:"<"}},[t._v("&lt;")]),t._v("!-- 集成feign httpclient依赖 --"),n("span",{pre:!0,attrs:{class:"token entity named-entity",title:">"}},[t._v("&gt;")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token entity named-entity",title:"<"}},[t._v("&lt;")]),t._v("dependency"),n("span",{pre:!0,attrs:{class:"token entity named-entity",title:">"}},[t._v("&gt;")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token entity named-entity",title:"<"}},[t._v("&lt;")]),t._v("groupId"),n("span",{pre:!0,attrs:{class:"token entity named-entity",title:">"}},[t._v("&gt;")]),t._v("io.github.openfeign"),n("span",{pre:!0,attrs:{class:"token entity named-entity",title:"<"}},[t._v("&lt;")]),t._v("/groupId"),n("span",{pre:!0,attrs:{class:"token entity named-entity",title:">"}},[t._v("&gt;")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token entity named-entity",title:"<"}},[t._v("&lt;")]),t._v("artifactId"),n("span",{pre:!0,attrs:{class:"token entity named-entity",title:">"}},[t._v("&gt;")]),t._v("feign-httpclient"),n("span",{pre:!0,attrs:{class:"token entity named-entity",title:"<"}},[t._v("&lt;")]),t._v("/artifactId"),n("span",{pre:!0,attrs:{class:"token entity named-entity",title:">"}},[t._v("&gt;")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token entity named-entity",title:"<"}},[t._v("&lt;")]),t._v("/dependency"),n("span",{pre:!0,attrs:{class:"token entity named-entity",title:">"}},[t._v("&gt;")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br")])]),n("ul",[n("li",[t._v("在服务提供者打断点，观察request对象，如果有以下header，表示feign请求时进行了压缩")])]),t._v(" "),n("p",[n("img",{attrs:{src:"/media//202104/2021-04-16_182636.png",alt:""}})]),t._v(" "),n("ul",[n("li",[t._v("配置nginx,修改nginx.conf文件，以开启gzip压缩，该配置位于http代码段中")])]),t._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[t._v("http"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("gzip")]),t._v(" on"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    gzip_static on"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    gzip_min_length  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    gzip_buffers     "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v(" 16k"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    gzip_http_version "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    gzip_comp_level "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    gzip_types     text/plain application/javascript application/x-javascript text/javascript text/css application/xml"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    gzip_vary on"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    gzip_proxied   expired no-cache no-store private auth"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    gzip_disable   "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("quot"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("MSIE "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("-6"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("."),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("quot"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br")])]),n("ul",[n("li",[t._v("使用postman测试，如果出现下图，则表示后端gzip压缩配置成功")])]),t._v(" "),n("p",[n("img",{attrs:{src:"/media//202012/gzip%E5%8E%8B%E7%BC%A9_1608279299.png",alt:""}})]),t._v(" "),n("ul",[n("li",[t._v("前端进行配置，将静态资源进行压缩\n"),n("ul",[n("li",[t._v("vue-cli 3.0在 "),n("strong",[t._v("vue.config.js")]),t._v("中配置")]),t._v(" "),n("li",[t._v("vue-cli 2.0在 "),n("strong",[t._v("index.js")]),t._v("中配置")])])])]),t._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("productionGzip"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br")])])])}),[],!1,null,null,null);s.default=e.exports}}]);