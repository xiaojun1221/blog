(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{525:function(s,n,t){"use strict";t.r(n);var a=t(3),e=Object(a.a)({},(function(){var s=this,n=s.$createElement,t=s._self._c||n;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"kubernetes部署常见问题"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#kubernetes部署常见问题"}},[s._v("#")]),s._v(" Kubernetes部署常见问题")]),s._v(" "),t("h2",{attrs:{id:"一、服务启动部署以后，看不到pod却可以看到pv、pvc、service等。"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#一、服务启动部署以后，看不到pod却可以看到pv、pvc、service等。"}},[s._v("#")]),s._v(" 一、服务启动部署以后，看不到pod却可以看到pv、pvc、service等。")]),s._v(" "),t("h3",{attrs:{id:"_1-1-排查思路"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-排查思路"}},[s._v("#")]),s._v(" 1.1 排查思路")]),s._v(" "),t("ol",[t("li",[s._v("使用 "),t("strong",[s._v("kubectl -n [ns] get replicasets.apps")]),s._v("来查看rs，进而使用"),t("strong",[s._v("describe")]),s._v("查询具体错误，根据错误信息找到解决方案")])]),s._v(" "),t("h3",{attrs:{id:"_1-2-资源限制导致的问题"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-资源限制导致的问题"}},[s._v("#")]),s._v(" 1.2 资源限制导致的问题")]),s._v(" "),t("ol",[t("li",[s._v("可能的原因：在一些k8s平台上可能由于一些资源限制导致pod达不到启动要求，而不进行启动")]),s._v(" "),t("li",[s._v("解决方法，修改资源限制，可从以下三个方面修改：")])]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#1. 查看命名空间是否有资源限制")]),s._v("\nkubectl -n ns get limitrange\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#1. 如果有，可以进行修改")]),s._v("\nkubectl -n ns edit limitrange\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#2. 查看命名空间是否有配额限制")]),s._v("\nkubectl -n ns get "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("quota")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#2. 如果有，可以进行修改")]),s._v("\nkubectl -n ns edit "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("quota")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#3. 修改应用的编排文件，修正请求的资源信息")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#3. 修改对象：")]),s._v("\nspec.template.spec.containers"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(".resources\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#对象说明")]),s._v("\nresources:\n  requests:\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#CPU至少具有（500/(1000*cpu核心数))%的资源可用")]),s._v("\n    cpu: 500m\n\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#内存至少有1GB")]),s._v("\n    memory: 1Gi\n  limits:\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#CPU至大允许使用（1000/(1000*cpu核心数))%的资源")]),s._v("\n    cpu: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#内存最多使用2GB")]),s._v("\n    memory: 2Gi\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br")])]),t("ol",{attrs:{start:"3"}},[t("li",[s._v("limits和requests的区别\n"),t("ul",[t("li",[t("strong",[s._v("limits:")]),s._v(" 指该pod能使用的最大资源，如果内存使用超过此资源，则会发生OOM，需要注意此项定义必须小于其所在命名空间中的limitRange,如果过高，则pod不会被调度(出现看不到pod的情况)。")]),s._v(" "),t("li",[t("strong",[s._v("requests:")]),s._v(" 指pod被调度时的最小资源，只有节点满足了此资源，pod才会被调度和部署。")])])])]),s._v(" "),t("h2",{attrs:{id:"二、服务启动部署以后，pod不断重启。"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#二、服务启动部署以后，pod不断重启。"}},[s._v("#")]),s._v(" 二、服务启动部署以后，pod不断重启。")]),s._v(" "),t("h3",{attrs:{id:"_2-1-排查思路"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-排查思路"}},[s._v("#")]),s._v(" 2.1 排查思路")]),s._v(" "),t("ol",[t("li",[s._v("使用 **kubectl -n [ns] describe pod [podname]**来查看pod的部署情况")]),s._v(" "),t("li",[s._v("使用 **kubectl -n [ns] logs -f [podname]**来查看pod的启动情况")])]),s._v(" "),t("h3",{attrs:{id:"_2-2-健康检查原因导致不断重启pod"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-健康检查原因导致不断重启pod"}},[s._v("#")]),s._v(" 2.2 健康检查原因导致不断重启pod")]),s._v(" "),t("ol",[t("li",[s._v("可能的原因：livenessProbe或readinessProbe参数设置不合理导致健康检查不通过，而重启服务")]),s._v(" "),t("li",[s._v("解决方法：修改编排文件中的livenessProbe和readinessProbe参数（通常是livenessProbe参数，因为readinessProbe就算探测不成功，也不会重启pod）")])]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#存活探针，如果探测成功，则会进入Running状态，如果失败，则会重启pod")]),s._v("\nlivenessProbe:\n  httpGet:\n    path: /actuator/health\n    port: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#通过增加此时间，保证应用能在此时间内能启动完成")]),s._v("\n  initialDelaySeconds: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 容器启动后第一次执行探测是需要等待多少秒.当前设定等待30秒。如果探测时没有得到结果，则会重启pod")]),s._v("\n  periodSeconds: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("             "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 执行探测的频率：每隔多长时间探测一次，默认是10秒，最小1秒。当前设定每隔20秒探测一次")]),s._v("\n  timeoutSeconds: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("             "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 探测超时时间：默认1秒，最小1秒。当前设定10秒超时重试")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#就绪探针，如果探测成功，则READY为true,反之，会继续进行探测，并不会将流量导入此pod，直到READY为true")]),s._v("\nreadinessProbe:\n  httpGet:\n    path: /actuator/health\n    port: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v("\n  initialDelaySeconds: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v("\n  periodSeconds: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("\n  timeoutSeconds: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br")])])])}),[],!1,null,null,null);n.default=e.exports}}]);