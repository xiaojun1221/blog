<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>centos+K8S群集监控环境构建 | jun的个人空间</title>
    <meta name="generator" content="VuePress 1.5.0">
    <link rel="icon" href="/blog/favicon.ico">
    <meta name="description" content="A simple and beautiful vuepress blog theme .">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    <link rel="preload" href="/blog/assets/css/0.styles.90237bae.css" as="style"><link rel="preload" href="/blog/assets/js/app.99c65bc6.js" as="script"><link rel="preload" href="/blog/assets/js/3.859d6461.js" as="script"><link rel="preload" href="/blog/assets/js/1.8f7e9fb3.js" as="script"><link rel="preload" href="/blog/assets/js/16.06f3b591.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.06cfad2a.js"><link rel="prefetch" href="/blog/assets/js/11.c6655e9c.js"><link rel="prefetch" href="/blog/assets/js/12.d9a8aa73.js"><link rel="prefetch" href="/blog/assets/js/13.d116a42f.js"><link rel="prefetch" href="/blog/assets/js/14.bdd69c21.js"><link rel="prefetch" href="/blog/assets/js/15.f8440334.js"><link rel="prefetch" href="/blog/assets/js/17.7dbba541.js"><link rel="prefetch" href="/blog/assets/js/18.3ebe6703.js"><link rel="prefetch" href="/blog/assets/js/19.96cc2197.js"><link rel="prefetch" href="/blog/assets/js/20.0c6af34a.js"><link rel="prefetch" href="/blog/assets/js/21.49332b74.js"><link rel="prefetch" href="/blog/assets/js/22.cc6494f6.js"><link rel="prefetch" href="/blog/assets/js/4.43fead6f.js"><link rel="prefetch" href="/blog/assets/js/5.303f6679.js"><link rel="prefetch" href="/blog/assets/js/6.c66adc43.js"><link rel="prefetch" href="/blog/assets/js/7.80c8e5f5.js"><link rel="prefetch" href="/blog/assets/js/8.0575fa6d.js"><link rel="prefetch" href="/blog/assets/js/9.a34de988.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.90237bae.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-945f89ac><div data-v-945f89ac><div id="loader-wrapper" class="loading-wrapper" data-v-2c578df8 data-v-945f89ac data-v-945f89ac><div class="loader-main" data-v-2c578df8><div data-v-2c578df8></div><div data-v-2c578df8></div><div data-v-2c578df8></div><div data-v-2c578df8></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-3dc17307 data-v-945f89ac data-v-945f89ac><h3 class="title" style="display:none;" data-v-3dc17307 data-v-3dc17307>jun的个人空间</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-3dc17307 data-v-3dc17307><input type="password" value="" data-v-3dc17307> <span data-v-3dc17307>Konck! Knock!</span> <button data-v-3dc17307>OK</button></label> <div class="footer" style="display:none;" data-v-3dc17307 data-v-3dc17307><span data-v-3dc17307><i class="iconfont reco-theme" data-v-3dc17307></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-3dc17307>vuePress-theme-reco</a></span> <span data-v-3dc17307><i class="iconfont reco-copyright" data-v-3dc17307></i> <a data-v-3dc17307><span data-v-3dc17307>jun</span>
            
          <span data-v-3dc17307>2017 - </span>
          2021
        </a></span></div></div> <div class="hide" data-v-945f89ac><header class="navbar" data-v-945f89ac><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><img src="/blog/logo.png" alt="jun的个人空间" class="logo"> <span class="site-name">jun的个人空间</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link"><i class="iconfont reco-home"></i>
  主页
</a></div><div class="nav-item"><a href="/blog/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  时间轴
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      文档
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/docs/theme-reco/" class="nav-link"><i class="iconfont undefined"></i>
  vuepress-reco
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      联系
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/recoluan" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont undefined"></i>
      Languages
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/blogs/centos/k8S群集监控环境.html" class="nav-link"><i class="iconfont undefined"></i>
  zh-CN
</a></li><li class="dropdown-item"><!----> <a href="/blog/en/" class="nav-link"><i class="iconfont undefined"></i>
  en-US
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-945f89ac></div> <aside class="sidebar" data-v-945f89ac><div class="personal-info-wrapper" data-v-661bee24><img src="/blog/avatar.jpg" alt="author-avatar" class="personal-img" data-v-661bee24> <h3 class="name" data-v-661bee24>
    jun
  </h3> <div class="num" data-v-661bee24><div data-v-661bee24><h3 data-v-661bee24>7</h3> <h6 data-v-661bee24>文章</h6></div> <div data-v-661bee24><h3 data-v-661bee24>7</h3> <h6 data-v-661bee24>标签</h6></div></div> <hr data-v-661bee24></div> <nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link"><i class="iconfont reco-home"></i>
  主页
</a></div><div class="nav-item"><a href="/blog/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  时间轴
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      文档
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/docs/theme-reco/" class="nav-link"><i class="iconfont undefined"></i>
  vuepress-reco
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      联系
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/recoluan" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont undefined"></i>
      Languages
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/blogs/centos/k8S群集监控环境.html" class="nav-link"><i class="iconfont undefined"></i>
  zh-CN
</a></li><li class="dropdown-item"><!----> <a href="/blog/en/" class="nav-link"><i class="iconfont undefined"></i>
  en-US
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>centos+K8S群集监控环境构建</span> <!----></p> <!----></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-3dc17307 data-v-945f89ac><h3 class="title" style="display:none;" data-v-3dc17307 data-v-3dc17307>centos+K8S群集监控环境构建</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-3dc17307 data-v-3dc17307><input type="password" value="" data-v-3dc17307> <span data-v-3dc17307>Konck! Knock!</span> <button data-v-3dc17307>OK</button></label> <div class="footer" style="display:none;" data-v-3dc17307 data-v-3dc17307><span data-v-3dc17307><i class="iconfont reco-theme" data-v-3dc17307></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-3dc17307>vuePress-theme-reco</a></span> <span data-v-3dc17307><i class="iconfont reco-copyright" data-v-3dc17307></i> <a data-v-3dc17307><span data-v-3dc17307>jun</span>
            
          <span data-v-3dc17307>2017 - </span>
          2021
        </a></span></div></div> <div data-v-945f89ac><main class="page"><div class="page-title" style="display:none;"><h1>centos+K8S群集监控环境构建</h1> <hr> <div data-v-32e7eb69><i class="iconfont reco-account" data-v-32e7eb69><span data-v-32e7eb69>jun</span></i> <i class="iconfont reco-date" data-v-32e7eb69><span data-v-32e7eb69>2020-06-16 09:15:25</span></i> <i class="iconfont reco-eye" data-v-32e7eb69><span id="/blog/blogs/centos/k8S%E7%BE%A4%E9%9B%86%E7%9B%91%E6%8E%A7%E7%8E%AF%E5%A2%83.html" data-flag-title="Your Article Title" class="leancloud-visitors" data-v-32e7eb69><a class="leancloud-visitors-count" style="font-size:.9rem;font-weight:normal;color:#999;"></a></span></i> <i class="iconfont reco-tag tags" data-v-32e7eb69><span class="tag-item" data-v-32e7eb69>centos</span><span class="tag-item" data-v-32e7eb69>docker</span><span class="tag-item" data-v-32e7eb69>K8S</span></i></div></div> <div class="theme-reco-content content__default" style="display:none;"><h3 id="虚拟机配置"><a href="#虚拟机配置" class="header-anchor">#</a> 虚拟机配置</h3> <p>准备三台虚拟机，每台虚机请参照<a href="">centos基础环境构建</a>、<a href="">centos构建docker基础环境</a>进行安装构建
&lt;!-- more --&gt;</p> <h4 id="一、-三台虚拟机配置表"><a href="#一、-三台虚拟机配置表" class="header-anchor">#</a> 一、 三台虚拟机配置表</h4> <ol><li>服务器配置</li></ol> <table><thead><tr><th style="text-align:center;">服务器IP</th> <th style="text-align:center;">域名</th> <th style="text-align:center;">别名</th> <th style="text-align:center;">服务器类别</th> <th style="text-align:center;">登录用户</th> <th style="text-align:center;">登录密码</th> <th style="text-align:center;">CPU</th> <th style="text-align:center;">内存</th></tr></thead> <tbody><tr><td style="text-align:center;">192.168.1.55</td> <td style="text-align:center;">master55.xincan.cn</td> <td style="text-align:center;">master55</td> <td style="text-align:center;">master</td> <td style="text-align:center;">root</td> <td style="text-align:center;">v*****t</td> <td style="text-align:center;">4核</td> <td style="text-align:center;">4G</td></tr> <tr><td style="text-align:center;">192.168.1.56</td> <td style="text-align:center;">slave56.xincan.cn</td> <td style="text-align:center;">slave56</td> <td style="text-align:center;">slave</td> <td style="text-align:center;">root</td> <td style="text-align:center;">v*****t</td> <td style="text-align:center;">2核</td> <td style="text-align:center;">2G</td></tr> <tr><td style="text-align:center;">192.168.1.57</td> <td style="text-align:center;">slave57.xincan.cn</td> <td style="text-align:center;">slave57</td> <td style="text-align:center;">slave</td> <td style="text-align:center;">root</td> <td style="text-align:center;">v*****t</td> <td style="text-align:center;">2核</td> <td style="text-align:center;">2G</td></tr></tbody></table> <ol start="2"><li>工具版本</li></ol> <p>docker version: v19.03.11
Kubernetes version: v1.18.2</p> <p>参考地址<a href="https://www.cnblogs.com/skyflask/p/11480988.html" target="_blank" rel="noopener noreferrer">kubernetes监控中级方案<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h4 id="二、-修改虚机域名"><a href="#二、-修改虚机域名" class="header-anchor">#</a> 二、 修改虚机域名</h4> <p>依次修改各个虚拟机域名为master55.xincan.cn、 slave56.xincan.cn、 slave57.xincan.cn</p> <div class="language-shell script line-numbers-mode"><pre class="language-shell"><code>// master55服务器
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># vi /etc/hostname</span>
master55.xincan.cn
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment">#</span>

// slave56服务器
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># vi /etc/hostname</span>
slave56.xincan.cn
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment">#</span>

// slave57服务器
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment">#  vi /etc/hostname</span>
slave57.xincan.cn
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment">#</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h4 id="三、-配置三台机器互相用域名、别名访问"><a href="#三、-配置三台机器互相用域名、别名访问" class="header-anchor">#</a> 三、 配置三台机器互相用域名、别名访问</h4> <p>修改/etc/hosts文件设置，3台服务器同时增加如下代码
192.168.1.55 master55.xincan.cn master55
192.168.1.56 slave56.xincan.cn slave56
192.168.1.57 slave57.xincan.cn slave57</p> <div class="language-shell script line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@localhost /<span class="token punctuation">]</span><span class="token comment"># cat /etc/hosts</span>
<span class="token number">127.0</span>.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
::1         localhost localhost.localdomain localhost6 localhost6.localdomain6

<span class="token number">192.168</span>.1.55 master55.xincan.cn master55
<span class="token number">192.168</span>.1.56 slave56.xincan.cn slave56
<span class="token number">192.168</span>.1.57 slave57.xincan.cn slave57
<span class="token punctuation">[</span>root@localhost /<span class="token punctuation">]</span><span class="token comment">#</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="四、-重启三台虚拟机，执行reboot"><a href="#四、-重启三台虚拟机，执行reboot" class="header-anchor">#</a> 四、 重启三台虚拟机，执行reboot</h4> <p>分别链接3台服务器，由之前的localhost已经改成服务器别名</p> <div class="language-shell script line-numbers-mode"><pre class="language-shell"><code> // master55
<span class="token punctuation">[</span>root@master55 ~<span class="token punctuation">]</span><span class="token comment">#</span>

 // master55
<span class="token punctuation">[</span>root@slave56 ~<span class="token punctuation">]</span><span class="token comment">#</span>

 // master55
<span class="token punctuation">[</span>root@slave57 ~<span class="token punctuation">]</span><span class="token comment">#</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="五、-三台服务器时间同步"><a href="#五、-三台服务器时间同步" class="header-anchor">#</a> 五、 三台服务器时间同步</h4> <ol><li>3台服务器都安装ntp，提示**Complete!**则安装成功</li></ol> <div class="language-shell script line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># sudo yum install -y ntp</span>
Loaded plugins: fastestmirror
Determining fastest mirrors
 * base: mirrors.huaweicloud.com
 * extras: mirrors.huaweicloud.com
 * updates: mirrors.ustc.edu.cn
base                                                                                                                          <span class="token operator">|</span> <span class="token number">3.6</span> kB  00:00:00
extras                                                                                                                        <span class="token operator">|</span> <span class="token number">2.9</span> kB  00:00:00
updates                                                                                                                       <span class="token operator">|</span> <span class="token number">2.9</span> kB  00:00:00
<span class="token punctuation">(</span><span class="token number">1</span>/4<span class="token punctuation">)</span>: base/7/x86_64/group_gz                                                                                                 <span class="token operator">|</span> <span class="token number">153</span> kB  00:00:00
<span class="token punctuation">(</span><span class="token number">2</span>/4<span class="token punctuation">)</span>: extras/7/x86_64/primary_db                                                                                             <span class="token operator">|</span> <span class="token number">194</span> kB  00:00:00
<span class="token punctuation">(</span><span class="token number">3</span>/4<span class="token punctuation">)</span>: updates/7/x86_64/primary_db                                                                                            <span class="token operator">|</span> <span class="token number">2.1</span> MB  00:00:01
<span class="token punctuation">(</span><span class="token number">4</span>/4<span class="token punctuation">)</span>: base/7/x86_64/primary_db                                                                                               <span class="token operator">|</span> <span class="token number">6.1</span> MB  00:00:05
Resolving Dependencies
--<span class="token operator">&amp;</span>gt<span class="token punctuation">;</span> Running transaction check
---<span class="token operator">&amp;</span>gt<span class="token punctuation">;</span> Package ntp.x86_64 <span class="token number">0</span>:4.2.6p5-29.el7.centos will be installed
--<span class="token operator">&amp;</span>gt<span class="token punctuation">;</span> Processing Dependency: ntpdate <span class="token operator">=</span> <span class="token number">4.2</span>.6p5-29.el7.centos <span class="token keyword">for</span> package: ntp-4.2.6p5-29.el7.centos.x86_64
--<span class="token operator">&amp;</span>gt<span class="token punctuation">;</span> Processing Dependency: libopts.so.25<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span>64bit<span class="token punctuation">)</span> <span class="token keyword">for</span> package: ntp-4.2.6p5-29.el7.centos.x86_64
--<span class="token operator">&amp;</span>gt<span class="token punctuation">;</span> Running transaction check
---<span class="token operator">&amp;</span>gt<span class="token punctuation">;</span> Package autogen-libopts.x86_64 <span class="token number">0</span>:5.18-5.el7 will be installed
---<span class="token operator">&amp;</span>gt<span class="token punctuation">;</span> Package ntpdate.x86_64 <span class="token number">0</span>:4.2.6p5-29.el7.centos will be installed
--<span class="token operator">&amp;</span>gt<span class="token punctuation">;</span> Finished Dependency Resolution

Dependencies Resolved

<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
 Package                                Arch                          Version                                      Repository                   Size
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
Installing:
 ntp                                    x86_64                        <span class="token number">4.2</span>.6p5-29.el7.centos                        base                        <span class="token number">548</span> k
Installing <span class="token keyword">for</span> dependencies:
 autogen-libopts                        x86_64                        <span class="token number">5.18</span>-5.el7                                   base                         <span class="token number">66</span> k
 ntpdate                                x86_64                        <span class="token number">4.2</span>.6p5-29.el7.centos                        base                         <span class="token number">86</span> k

Transaction Summary
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
Install  <span class="token number">1</span> Package <span class="token punctuation">(</span>+2 Dependent packages<span class="token punctuation">)</span>

Total download size: <span class="token number">701</span> k
Installed size: <span class="token number">1.6</span> M
Downloading packages:
warning: /var/cache/yum/x86_64/7/base/packages/ntpdate-4.2.6p5-29.el7.centos.x86_64.rpm: Header V3 RSA/SHA256 Signature, key ID f4a80eb5: NOKEY- ETA
Public key <span class="token keyword">for</span> ntpdate-4.2.6p5-29.el7.centos.x86_64.rpm is not installed
<span class="token punctuation">(</span><span class="token number">1</span>/3<span class="token punctuation">)</span>: ntpdate-4.2.6p5-29.el7.centos.x86_64.rpm                                                                               <span class="token operator">|</span>  <span class="token number">86</span> kB  00:00:00
<span class="token punctuation">(</span><span class="token number">2</span>/3<span class="token punctuation">)</span>: autogen-libopts-5.18-5.el7.x86_64.rpm                                                                                  <span class="token operator">|</span>  <span class="token number">66</span> kB  00:00:00
<span class="token punctuation">(</span><span class="token number">3</span>/3<span class="token punctuation">)</span>: ntp-4.2.6p5-29.el7.centos.x86_64.rpm                                                                                   <span class="token operator">|</span> <span class="token number">548</span> kB  00:00:00
-----------------------------------------------------------------------------------------------------------------------------------------------------
Total                                                                                                                <span class="token number">956</span> kB/s <span class="token operator">|</span> <span class="token number">701</span> kB  00:00:00
Retrieving key from file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7
Importing GPG key 0xF4A80EB5:
 Userid     <span class="token builtin class-name">:</span> <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>CentOS-7 Key <span class="token punctuation">(</span>CentOS <span class="token number">7</span> Official Signing Key<span class="token punctuation">)</span> <span class="token operator">&amp;</span>lt<span class="token punctuation">;</span>security@centos.org<span class="token operator">&amp;</span>gt<span class="token punctuation">;</span><span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>
 Fingerprint: <span class="token number">6341</span> ab27 53d7 8a78 a7c2 7bb1 24c6 a8a7 f4a8 0eb5
 Package    <span class="token builtin class-name">:</span> centos-release-7-6.1810.2.el7.centos.x86_64 <span class="token punctuation">(</span>@anaconda<span class="token punctuation">)</span>
 From       <span class="token builtin class-name">:</span> /etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7
Running transaction check
Running transaction <span class="token builtin class-name">test</span>
Transaction <span class="token builtin class-name">test</span> succeeded
Running transaction
  Installing <span class="token builtin class-name">:</span> autogen-libopts-5.18-5.el7.x86_64                                                                                                 <span class="token number">1</span>/3
  Installing <span class="token builtin class-name">:</span> ntpdate-4.2.6p5-29.el7.centos.x86_64                                                                                              <span class="token number">2</span>/3
  Installing <span class="token builtin class-name">:</span> ntp-4.2.6p5-29.el7.centos.x86_64                                                                                                  <span class="token number">3</span>/3
  Verifying  <span class="token builtin class-name">:</span> ntp-4.2.6p5-29.el7.centos.x86_64                                                                                                  <span class="token number">1</span>/3
  Verifying  <span class="token builtin class-name">:</span> ntpdate-4.2.6p5-29.el7.centos.x86_64                                                                                              <span class="token number">2</span>/3
  Verifying  <span class="token builtin class-name">:</span> autogen-libopts-5.18-5.el7.x86_64                                                                                                 <span class="token number">3</span>/3

Installed:
  ntp.x86_64 <span class="token number">0</span>:4.2.6p5-29.el7.centos

Dependency Installed:
  autogen-libopts.x86_64 <span class="token number">0</span>:5.18-5.el7                                     ntpdate.x86_64 <span class="token number">0</span>:4.2.6p5-29.el7.centos

Complete<span class="token operator">!</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment">#</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br></div></div><ol start="2"><li>3台服务器同时设置，查看当前系统时间、并设置当前时间为上海</li></ol> <div class="language-shell script line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@localhost /<span class="token punctuation">]</span><span class="token comment"># date</span>
Thu Jun  <span class="token number">4</span> 05:28:48 UTC <span class="token number">2020</span>
<span class="token punctuation">[</span>root@localhost /<span class="token punctuation">]</span><span class="token comment"># ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</span>
<span class="token punctuation">[</span>root@localhost /<span class="token punctuation">]</span><span class="token comment"># date</span>
Thu Jun  <span class="token number">4</span> <span class="token number">13</span>:29:01 CST <span class="token number">2020</span>
<span class="token punctuation">[</span>root@localhost /<span class="token punctuation">]</span><span class="token comment"># </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ol start="3"><li>master55配置<strong>server ntp.aliyun.com iburst</strong>，然后通过<strong>sudo systemctl start ntpd</strong>启动服务，稍等一会执行<strong>ntpq -p</strong>查看是否同步，如果出现前面的*则，同步成功</li></ol> <p>systemctl start ntpd            &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;启动ntp
systemctl restart ntpd          &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;重启ntp
systemctl enable ntpd.service   &amp;nbsp;&amp;nbsp;开机启动
ntpdc -c loopinfo               &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;查看与时间同步服务器的时间差</p> <div class="language-shell script line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@master55 /<span class="token punctuation">]</span><span class="token comment"># vi /etc/ntp.conf</span>

<span class="token comment"># server 0.centos.pool.ntp.org iburst</span>
<span class="token comment"># server 1.centos.pool.ntp.org iburst</span>
<span class="token comment"># server 2.centos.pool.ntp.org iburst</span>
<span class="token comment"># server 3.centos.pool.ntp.org iburst</span>

server ntp.aliyun.com iburst

<span class="token punctuation">[</span>root@master55 /<span class="token punctuation">]</span><span class="token comment">#</span>
<span class="token punctuation">[</span>root@master55 /<span class="token punctuation">]</span><span class="token comment"># sudo systemctl start ntpd</span>
<span class="token punctuation">[</span>root@master55 /<span class="token punctuation">]</span><span class="token comment"># systemctl enable ntpd.service</span>
Created symlink from /etc/systemd/system/multi-user.target.wants/ntpd.service to /usr/lib/systemd/system/ntpd.service.
<span class="token punctuation">[</span>root@localhost /<span class="token punctuation">]</span><span class="token comment"># ntpq -p</span>
     remote           refid      st t when poll reach   delay   offset  jitter
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
*203.107.6.88    <span class="token number">10.137</span>.38.86     <span class="token number">2</span> u   <span class="token number">37</span>   <span class="token number">64</span>    <span class="token number">1</span>   <span class="token number">53.476</span>   -5.668   <span class="token number">2.224</span>
<span class="token punctuation">[</span>root@master55 /<span class="token punctuation">]</span><span class="token comment">#</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><ol start="4"><li>slave56、slave57配置master55域名地址<strong>server master55.xincan.cn iburst</strong>，然后通过<strong>sudo systemctl start ntpd</strong>启动服务，稍等一会执行<strong>ntpq -p</strong>查看是否同步，如果出现前面的*则，同步成功</li></ol> <p>slave56设置</p> <div class="language-shell script line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@slave56 /<span class="token punctuation">]</span><span class="token comment"># vi /etc/ntp.conf</span>

<span class="token comment"># server 0.centos.pool.ntp.org iburst</span>
<span class="token comment"># server 1.centos.pool.ntp.org iburst</span>
<span class="token comment"># server 2.centos.pool.ntp.org iburst</span>
<span class="token comment"># server 3.centos.pool.ntp.org iburst</span>

server master55.xincan.cn iburst

<span class="token punctuation">[</span>root@slave56 /<span class="token punctuation">]</span><span class="token comment">#</span>
<span class="token punctuation">[</span>root@slave56 /<span class="token punctuation">]</span><span class="token comment"># sudo systemctl start ntpd</span>
<span class="token punctuation">[</span>root@slave56 /<span class="token punctuation">]</span><span class="token comment"># systemctl enable ntpd.service</span>
Created symlink from /etc/systemd/system/multi-user.target.wants/ntpd.service to /usr/lib/systemd/system/ntpd.service.
<span class="token punctuation">[</span>root@slave56 /<span class="token punctuation">]</span><span class="token comment"># ntpq -p</span>
     remote           refid      st t when poll reach   delay   offset  jitter
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
*master55.xincan <span class="token number">203.107</span>.6.88     <span class="token number">3</span> u   <span class="token number">12</span>   <span class="token number">64</span>    <span class="token number">1</span>    <span class="token number">0.367</span>   <span class="token number">10.659</span>   <span class="token number">0.054</span>
<span class="token punctuation">[</span>root@slave56 /<span class="token punctuation">]</span><span class="token comment">#</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>slave57设置</p> <div class="language-shell script line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@slave57 /<span class="token punctuation">]</span><span class="token comment"># vi /etc/ntp.conf</span>

<span class="token comment"># server 0.centos.pool.ntp.org iburst</span>
<span class="token comment"># server 1.centos.pool.ntp.org iburst</span>
<span class="token comment"># server 2.centos.pool.ntp.org iburst</span>
<span class="token comment"># server 3.centos.pool.ntp.org iburst</span>

server master55.xincan.cn iburst

<span class="token punctuation">[</span>root@slave57 /<span class="token punctuation">]</span><span class="token comment">#</span>
<span class="token punctuation">[</span>root@slave57 /<span class="token punctuation">]</span><span class="token comment"># sudo systemctl start ntpd</span>
<span class="token punctuation">[</span>root@slave57 /<span class="token punctuation">]</span><span class="token comment"># systemctl enable ntpd.service</span>
Created symlink from /etc/systemd/system/multi-user.target.wants/ntpd.service to /usr/lib/systemd/system/ntpd.service.
<span class="token punctuation">[</span>root@slave57 /<span class="token punctuation">]</span><span class="token comment"># ntpq -p</span>
     remote           refid      st t when poll reach   delay   offset  jitter
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
*master55.xincan <span class="token number">203.107</span>.6.88     <span class="token number">3</span> u   <span class="token number">12</span>   <span class="token number">64</span>    <span class="token number">1</span>    <span class="token number">0.367</span>   <span class="token number">10.659</span>   <span class="token number">0.054</span>
<span class="token punctuation">[</span>root@slave57 /<span class="token punctuation">]</span><span class="token comment">#</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h4 id="六、-三台服务器同时配置kubernetes网桥"><a href="#六、-三台服务器同时配置kubernetes网桥" class="header-anchor">#</a> 六、 三台服务器同时配置kubernetes网桥</h4> <p>设置网桥为值为1</p> <ol><li>master55设置</li></ol> <div class="language-shell script line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@master55 /<span class="token punctuation">]</span><span class="token comment"># sudo bash -c &amp;#39;cat &amp;lt;&amp;lt;EOF &amp;gt;  /etc/sysctl.d/k8s.conf</span>
net.bridge.bridge-nf-call-ip6tables <span class="token operator">=</span> <span class="token number">1</span>
net.bridge.bridge-nf-call-iptables <span class="token operator">=</span> <span class="token number">1</span>
net.ipv4.ip_forward<span class="token operator">=</span><span class="token number">1</span>
EOF<span class="token operator">&amp;</span><span class="token comment">#39;</span>

<span class="token punctuation">[</span>root@master55 /<span class="token punctuation">]</span><span class="token comment">#</span>
<span class="token punctuation">[</span>root@master55 /<span class="token punctuation">]</span><span class="token comment"># sysctl --system</span>
* Applying /usr/lib/sysctl.d/00-system.conf <span class="token punctuation">..</span>.
net.bridge.bridge-nf-call-ip6tables <span class="token operator">=</span> <span class="token number">0</span>
net.bridge.bridge-nf-call-iptables <span class="token operator">=</span> <span class="token number">0</span>
net.bridge.bridge-nf-call-arptables <span class="token operator">=</span> <span class="token number">0</span>
* Applying /usr/lib/sysctl.d/10-default-yama-scope.conf <span class="token punctuation">..</span>.
kernel.yama.ptrace_scope <span class="token operator">=</span> <span class="token number">0</span>
* Applying /usr/lib/sysctl.d/50-default.conf <span class="token punctuation">..</span>.
kernel.sysrq <span class="token operator">=</span> <span class="token number">16</span>
kernel.core_uses_pid <span class="token operator">=</span> <span class="token number">1</span>
net.ipv4.conf.default.rp_filter <span class="token operator">=</span> <span class="token number">1</span>
net.ipv4.conf.all.rp_filter <span class="token operator">=</span> <span class="token number">1</span>
net.ipv4.conf.default.accept_source_route <span class="token operator">=</span> <span class="token number">0</span>
net.ipv4.conf.all.accept_source_route <span class="token operator">=</span> <span class="token number">0</span>
net.ipv4.conf.default.promote_secondaries <span class="token operator">=</span> <span class="token number">1</span>
net.ipv4.conf.all.promote_secondaries <span class="token operator">=</span> <span class="token number">1</span>
fs.protected_hardlinks <span class="token operator">=</span> <span class="token number">1</span>
fs.protected_symlinks <span class="token operator">=</span> <span class="token number">1</span>
* Applying /etc/sysctl.d/99-sysctl.conf <span class="token punctuation">..</span>.
* Applying /etc/sysctl.d/k8s.conf <span class="token punctuation">..</span>.
net.bridge.bridge-nf-call-ip6tables <span class="token operator">=</span> <span class="token number">1</span>
net.bridge.bridge-nf-call-iptables <span class="token operator">=</span> <span class="token number">1</span>
net.ipv4.ip_forward <span class="token operator">=</span> <span class="token number">1</span>
* Applying /etc/sysctl.conf <span class="token punctuation">..</span>.
<span class="token punctuation">[</span>root@master55 /<span class="token punctuation">]</span><span class="token comment">#</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><ol start="2"><li>slave56设置</li></ol> <div class="language-shell script line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@slave56 /<span class="token punctuation">]</span><span class="token comment"># sudo bash -c &amp;#39;cat &amp;lt;&amp;lt;EOF &amp;gt;  /etc/sysctl.d/k8s.conf</span>
net.bridge.bridge-nf-call-ip6tables <span class="token operator">=</span> <span class="token number">1</span>
net.bridge.bridge-nf-call-iptables <span class="token operator">=</span> <span class="token number">1</span>
net.ipv4.ip_forward<span class="token operator">=</span><span class="token number">1</span>
EOF<span class="token operator">&amp;</span><span class="token comment">#39;</span>

<span class="token punctuation">[</span>root@slave56 /<span class="token punctuation">]</span><span class="token comment">#</span>
<span class="token punctuation">[</span>root@slave56 /<span class="token punctuation">]</span><span class="token comment"># sysctl --system</span>
* Applying /usr/lib/sysctl.d/00-system.conf <span class="token punctuation">..</span>.
net.bridge.bridge-nf-call-ip6tables <span class="token operator">=</span> <span class="token number">0</span>
net.bridge.bridge-nf-call-iptables <span class="token operator">=</span> <span class="token number">0</span>
net.bridge.bridge-nf-call-arptables <span class="token operator">=</span> <span class="token number">0</span>
* Applying /usr/lib/sysctl.d/10-default-yama-scope.conf <span class="token punctuation">..</span>.
kernel.yama.ptrace_scope <span class="token operator">=</span> <span class="token number">0</span>
* Applying /usr/lib/sysctl.d/50-default.conf <span class="token punctuation">..</span>.
kernel.sysrq <span class="token operator">=</span> <span class="token number">16</span>
kernel.core_uses_pid <span class="token operator">=</span> <span class="token number">1</span>
net.ipv4.conf.default.rp_filter <span class="token operator">=</span> <span class="token number">1</span>
net.ipv4.conf.all.rp_filter <span class="token operator">=</span> <span class="token number">1</span>
net.ipv4.conf.default.accept_source_route <span class="token operator">=</span> <span class="token number">0</span>
net.ipv4.conf.all.accept_source_route <span class="token operator">=</span> <span class="token number">0</span>
net.ipv4.conf.default.promote_secondaries <span class="token operator">=</span> <span class="token number">1</span>
net.ipv4.conf.all.promote_secondaries <span class="token operator">=</span> <span class="token number">1</span>
fs.protected_hardlinks <span class="token operator">=</span> <span class="token number">1</span>
fs.protected_symlinks <span class="token operator">=</span> <span class="token number">1</span>
* Applying /etc/sysctl.d/99-sysctl.conf <span class="token punctuation">..</span>.
* Applying /etc/sysctl.d/k8s.conf <span class="token punctuation">..</span>.
net.bridge.bridge-nf-call-ip6tables <span class="token operator">=</span> <span class="token number">1</span>
net.bridge.bridge-nf-call-iptables <span class="token operator">=</span> <span class="token number">1</span>
net.ipv4.ip_forward <span class="token operator">=</span> <span class="token number">1</span>
* Applying /etc/sysctl.conf <span class="token punctuation">..</span>.
<span class="token punctuation">[</span>root@slave56 /<span class="token punctuation">]</span><span class="token comment">#</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><ol start="3"><li>slave57设置</li></ol> <div class="language-shell script line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@slave57 /<span class="token punctuation">]</span><span class="token comment"># sudo bash -c &amp;#39;cat &amp;lt;&amp;lt;EOF &amp;gt;  /etc/sysctl.d/k8s.conf</span>
net.bridge.bridge-nf-call-ip6tables <span class="token operator">=</span> <span class="token number">1</span>
net.bridge.bridge-nf-call-iptables <span class="token operator">=</span> <span class="token number">1</span>
net.ipv4.ip_forward<span class="token operator">=</span><span class="token number">1</span>
EOF<span class="token operator">&amp;</span><span class="token comment">#39;</span>

<span class="token punctuation">[</span>root@slave57 /<span class="token punctuation">]</span><span class="token comment">#</span>
<span class="token punctuation">[</span>root@slave57 /<span class="token punctuation">]</span><span class="token comment"># sysctl --system</span>
* Applying /usr/lib/sysctl.d/00-system.conf <span class="token punctuation">..</span>.
net.bridge.bridge-nf-call-ip6tables <span class="token operator">=</span> <span class="token number">0</span>
net.bridge.bridge-nf-call-iptables <span class="token operator">=</span> <span class="token number">0</span>
net.bridge.bridge-nf-call-arptables <span class="token operator">=</span> <span class="token number">0</span>
* Applying /usr/lib/sysctl.d/10-default-yama-scope.conf <span class="token punctuation">..</span>.
kernel.yama.ptrace_scope <span class="token operator">=</span> <span class="token number">0</span>
* Applying /usr/lib/sysctl.d/50-default.conf <span class="token punctuation">..</span>.
kernel.sysrq <span class="token operator">=</span> <span class="token number">16</span>
kernel.core_uses_pid <span class="token operator">=</span> <span class="token number">1</span>
net.ipv4.conf.default.rp_filter <span class="token operator">=</span> <span class="token number">1</span>
net.ipv4.conf.all.rp_filter <span class="token operator">=</span> <span class="token number">1</span>
net.ipv4.conf.default.accept_source_route <span class="token operator">=</span> <span class="token number">0</span>
net.ipv4.conf.all.accept_source_route <span class="token operator">=</span> <span class="token number">0</span>
net.ipv4.conf.default.promote_secondaries <span class="token operator">=</span> <span class="token number">1</span>
net.ipv4.conf.all.promote_secondaries <span class="token operator">=</span> <span class="token number">1</span>
fs.protected_hardlinks <span class="token operator">=</span> <span class="token number">1</span>
fs.protected_symlinks <span class="token operator">=</span> <span class="token number">1</span>
* Applying /etc/sysctl.d/99-sysctl.conf <span class="token punctuation">..</span>.
* Applying /etc/sysctl.d/k8s.conf <span class="token punctuation">..</span>.
net.bridge.bridge-nf-call-ip6tables <span class="token operator">=</span> <span class="token number">1</span>
net.bridge.bridge-nf-call-iptables <span class="token operator">=</span> <span class="token number">1</span>
net.ipv4.ip_forward <span class="token operator">=</span> <span class="token number">1</span>
* Applying /etc/sysctl.conf <span class="token punctuation">..</span>.
<span class="token punctuation">[</span>root@slave57 /<span class="token punctuation">]</span><span class="token comment">#</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><h4 id="七、-三台服务器同时配置kubernetes下载源，关闭selinux"><a href="#七、-三台服务器同时配置kubernetes下载源，关闭selinux" class="header-anchor">#</a> 七、 三台服务器同时配置kubernetes下载源，关闭SELinux</h4> <ol><li>master55设置</li></ol> <div class="language-shell script line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@master55 /<span class="token punctuation">]</span><span class="token comment"># sudo bash -c &amp;#39;cat &amp;lt;&amp;lt;EOF &amp;gt; /etc/yum.repos.d/kubernetes.repo</span>
<span class="token punctuation">[</span>kubernetes<span class="token punctuation">]</span>
<span class="token assign-left variable">name</span><span class="token operator">=</span>Kubernetes
<span class="token assign-left variable">baseurl</span><span class="token operator">=</span>http://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64
<span class="token assign-left variable">enabled</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token assign-left variable">gpgcheck</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token assign-left variable">repo_gpgcheck</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token assign-left variable">gpgkey</span><span class="token operator">=</span>http://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg http://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg
EOF<span class="token operator">&amp;</span><span class="token comment">#39;</span>

<span class="token punctuation">[</span>root@master55 /<span class="token punctuation">]</span><span class="token comment">#</span>
<span class="token punctuation">[</span>root@master55 /<span class="token punctuation">]</span><span class="token comment"># sudo setenforce 0</span>
setenforce: SELinux is disabled
<span class="token punctuation">[</span>root@master55 /<span class="token punctuation">]</span><span class="token comment">#</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><ol start="2"><li>slave56设置</li></ol> <div class="language-shell script line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@slave56 /<span class="token punctuation">]</span><span class="token comment"># sudo bash -c &amp;#39;cat &amp;lt;&amp;lt;EOF &amp;gt; /etc/yum.repos.d/kubernetes.repo</span>
<span class="token punctuation">[</span>kubernetes<span class="token punctuation">]</span>
<span class="token assign-left variable">name</span><span class="token operator">=</span>Kubernetes
<span class="token assign-left variable">baseurl</span><span class="token operator">=</span>http://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64
<span class="token assign-left variable">enabled</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token assign-left variable">gpgcheck</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token assign-left variable">repo_gpgcheck</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token assign-left variable">gpgkey</span><span class="token operator">=</span>http://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg http://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg
EOF<span class="token operator">&amp;</span><span class="token comment">#39;</span>

<span class="token punctuation">[</span>root@slave56 /<span class="token punctuation">]</span><span class="token comment">#</span>
setenforce: SELinux is disabled
<span class="token punctuation">[</span>root@slave56 /<span class="token punctuation">]</span><span class="token comment"># sudo setenforce 0</span>
<span class="token punctuation">[</span>root@slave56 /<span class="token punctuation">]</span><span class="token comment">#</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><ol start="3"><li>slave57设置</li></ol> <div class="language-shell script line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@slave57 /<span class="token punctuation">]</span><span class="token comment"># sudo bash -c &amp;#39;cat &amp;lt;&amp;lt;EOF &amp;gt; /etc/yum.repos.d/kubernetes.repo</span>
<span class="token punctuation">[</span>kubernetes<span class="token punctuation">]</span>
<span class="token assign-left variable">name</span><span class="token operator">=</span>Kubernetes
<span class="token assign-left variable">baseurl</span><span class="token operator">=</span>http://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64
<span class="token assign-left variable">enabled</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token assign-left variable">gpgcheck</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token assign-left variable">repo_gpgcheck</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token assign-left variable">gpgkey</span><span class="token operator">=</span>http://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg http://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg
EOF<span class="token operator">&amp;</span><span class="token comment">#39;</span>

<span class="token punctuation">[</span>root@slave57 /<span class="token punctuation">]</span><span class="token comment">#</span>
<span class="token punctuation">[</span>root@slave57 /<span class="token punctuation">]</span><span class="token comment"># sudo setenforce 0</span>
setenforce: SELinux is disabled
<span class="token punctuation">[</span>root@slave57 /<span class="token punctuation">]</span><span class="token comment">#</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h4 id="八、-查看三台服务器下载源列表，如下成功"><a href="#八、-查看三台服务器下载源列表，如下成功" class="header-anchor">#</a> 八、 查看三台服务器下载源列表，如下成功</h4> <div class="language-shell script line-numbers-mode"><pre class="language-shell"><code>drwxr-xr-x. <span class="token number">2</span> root root  <span class="token number">187</span> Jun <span class="token number">16</span> <span class="token number">13</span>:05 backup
-rw-r--r--. <span class="token number">1</span> root root <span class="token number">2523</span> Jun <span class="token number">16</span>  <span class="token number">2018</span> CentOS-Base.repo
-rw-r--r--. <span class="token number">1</span> root root <span class="token number">2424</span> Oct <span class="token number">19</span>  <span class="token number">2019</span> docker-ce.repo
-rw-r--r--. <span class="token number">1</span> root root  <span class="token number">272</span> Jun <span class="token number">16</span> <span class="token number">16</span>:34 kubernetes.repo
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="九、-三台服务器设置免密登录"><a href="#九、-三台服务器设置免密登录" class="header-anchor">#</a> 九、 三台服务器设置免密登录</h4> <p>1：manager节点执行：ssh-keygen -t rsa 一路回车到结束，在/root/.ssh/下面会生成一个公钥文件id_rsa.pub</p> <div class="language-shell script line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@master55 /<span class="token punctuation">]</span><span class="token comment"># ssh-keygen -t rsa</span>
Generating public/private rsa key pair.
Enter <span class="token function">file</span> <span class="token keyword">in</span> <span class="token function">which</span> to save the key <span class="token punctuation">(</span>/root/.ssh/id_rsa<span class="token punctuation">)</span>:
Created directory <span class="token operator">&amp;</span><span class="token comment">#39;/root/.ssh&amp;#39;.</span>
Enter passphrase <span class="token punctuation">(</span>empty <span class="token keyword">for</span> no passphrase<span class="token punctuation">)</span>:
Enter same passphrase again:
Your identification has been saved <span class="token keyword">in</span> /root/.ssh/id_rsa.
Your public key has been saved <span class="token keyword">in</span> /root/.ssh/id_rsa.pub.
The key fingerprint is:
SHA256:I0PR5fMj01uGGb1Z3pbRFjzwTIFb2ONyZ1M2I9OVTNY root@master55.xincan.cn
The key<span class="token operator">&amp;</span><span class="token comment">#39;s randomart image is:</span>
+---<span class="token punctuation">[</span>RSA <span class="token number">2048</span><span class="token punctuation">]</span>----+
<span class="token operator">|</span>      <span class="token punctuation">..</span> <span class="token punctuation">..</span>  .X**<span class="token operator">|</span>
<span class="token operator">|</span>       <span class="token punctuation">..</span>.   *<span class="token operator">=</span>%E<span class="token operator">|</span>
<span class="token operator">|</span>      <span class="token builtin class-name">.</span>   o <span class="token builtin class-name">.</span> <span class="token assign-left variable">B</span><span class="token operator">=</span>X<span class="token operator">|</span>
<span class="token operator">|</span>     <span class="token builtin class-name">.</span>     + * X*<span class="token operator">|</span>
<span class="token operator">|</span>      o S o * Bo*<span class="token operator">|</span>
<span class="token operator">|</span>       o <span class="token builtin class-name">.</span> o <span class="token operator">=</span> <span class="token builtin class-name">.</span> <span class="token operator">|</span>
<span class="token operator">|</span>            <span class="token builtin class-name">.</span>    <span class="token operator">|</span>
<span class="token operator">|</span>                 <span class="token operator">|</span>
<span class="token operator">|</span>                 <span class="token operator">|</span>
+----<span class="token punctuation">[</span>SHA256<span class="token punctuation">]</span>-----+
<span class="token punctuation">[</span>root@master55 /<span class="token punctuation">]</span><span class="token comment">#     </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><ol start="2"><li>将公钥追加到authorized_keys</li></ol> <div class="language-shell script line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@master55 /<span class="token punctuation">]</span><span class="token comment"># cat ~/.ssh/id_rsa.pub &amp;gt;&amp;gt; ~/.ssh/authorized_keys</span>
<span class="token punctuation">[</span>root@master55 /<span class="token punctuation">]</span><span class="token comment"># cd ~/.ssh/</span>
<span class="token punctuation">[</span>root@master55 .ssh<span class="token punctuation">]</span><span class="token comment"># ll</span>
total <span class="token number">12</span>
-rw-r--r-- <span class="token number">1</span> root root  <span class="token number">405</span> Jun <span class="token number">16</span> <span class="token number">17</span>:03 authorized_keys
-rw------- <span class="token number">1</span> root root <span class="token number">1675</span> Jun <span class="token number">16</span> <span class="token number">17</span>:01 id_rsa
-rw-r--r-- <span class="token number">1</span> root root  <span class="token number">405</span> Jun <span class="token number">16</span> <span class="token number">17</span>:01 id_rsa.pub
<span class="token punctuation">[</span>root@master55 .ssh<span class="token punctuation">]</span><span class="token comment">#  </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><ol start="3"><li>修改authorized_keys权限：</li></ol> <div class="language-shell script line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@master55 /<span class="token punctuation">]</span><span class="token comment"># chmod 600 ~/.ssh/authorized_keys</span>
<span class="token punctuation">[</span>root@master55 /<span class="token punctuation">]</span><span class="token comment"># </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ol start="4"><li>将~/.ssh从master55节点分发到slave56、slave57节点，执行：
scp -r ~/.ssh/ root@slave56:~/.ssh/
scp -r ~/.ssh/ root@slave57:~/.ssh/
过程中需要填写yes，然后提示输入slave56、slave57两个节点的登录密码</li></ol> <div class="language-shell script line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@master55 .ssh<span class="token punctuation">]</span><span class="token comment"># scp -r ~/.ssh/ root@slave56:~/.ssh/</span>
The authenticity of <span class="token function">host</span> <span class="token operator">&amp;</span><span class="token comment">#39;slave56 (192.168.1.56)&amp;#39; can&amp;#39;t be established.</span>
ECDSA key fingerprint is SHA256:KhL6Vyv6q5fHHcZ3+xoLn6W/mZ7SBAFD+n/TCXEHtSM.
ECDSA key fingerprint is MD5:71:35:87:3d:ff:73:04:fc:d7:a2:07:30:68:b8:62:5b.
Are you sure you want to <span class="token builtin class-name">continue</span> connecting <span class="token punctuation">(</span>yes/no<span class="token punctuation">)</span>? <span class="token function">yes</span>
Warning: Permanently added <span class="token operator">&amp;</span><span class="token comment">#39;slave56,192.168.1.56&amp;#39; (ECDSA) to the list of known hosts.</span>
root@slave56<span class="token operator">&amp;</span><span class="token comment">#39;s password:</span>
id_rsa                                                                                             <span class="token number">100</span>% <span class="token number">1675</span>     <span class="token number">1</span>.1MB/s   00:00
id_rsa.pub                                                                                         <span class="token number">100</span>%  <span class="token number">405</span>   <span class="token number">282</span>.4KB/s   00:00
authorized_keys                                                                                    <span class="token number">100</span>%  <span class="token number">405</span>   <span class="token number">277</span>.0KB/s   00:00
known_hosts                                                                                        <span class="token number">100</span>%  <span class="token number">182</span>   <span class="token number">104</span>.6KB/s   00:00
<span class="token punctuation">[</span>root@master55 .ssh<span class="token punctuation">]</span><span class="token comment"># scp -r ~/.ssh/ root@slave57:~/.ssh/</span>
The authenticity of <span class="token function">host</span> <span class="token operator">&amp;</span><span class="token comment">#39;slave57 (192.168.1.57)&amp;#39; can&amp;#39;t be established.</span>
ECDSA key fingerprint is SHA256:Gfz+xXR217Yb2ZWOIMsRzSe+iynRvpxLnt98cI4kBRA.
ECDSA key fingerprint is MD5:8b:1d:cd:1d:24:79:de:80:c3:53:7c:d3:87:e0:d4:96.
Are you sure you want to <span class="token builtin class-name">continue</span> connecting <span class="token punctuation">(</span>yes/no<span class="token punctuation">)</span>? <span class="token function">yes</span>
Warning: Permanently added <span class="token operator">&amp;</span><span class="token comment">#39;slave57,192.168.1.57&amp;#39; (ECDSA) to the list of known hosts.</span>
root@slave57<span class="token operator">&amp;</span><span class="token comment">#39;s password:</span>
id_rsa                                                                                             <span class="token number">100</span>% <span class="token number">1675</span>     <span class="token number">1</span>.0MB/s   00:00
id_rsa.pub                                                                                         <span class="token number">100</span>%  <span class="token number">405</span>   <span class="token number">304</span>.6KB/s   00:00
authorized_keys                                                                                    <span class="token number">100</span>%  <span class="token number">405</span>   <span class="token number">352</span>.7KB/s   00:00
known_hosts                                                                                        <span class="token number">100</span>%  <span class="token number">364</span>   <span class="token number">271</span>.2KB/s   00:00
<span class="token punctuation">[</span>root@master55 .ssh<span class="token punctuation">]</span><span class="token comment"># </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><ol start="5"><li>验证master55、slave56、slave57三个节点免密登录
master55节点验证</li></ol> <div class="language-shell script line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@master55 /<span class="token punctuation">]</span><span class="token comment"># ssh root@slave56</span>
Last login: Tue Jun <span class="token number">16</span> <span class="token number">15</span>:11:10 <span class="token number">2020</span> from <span class="token number">192.168</span>.1.182
<span class="token punctuation">[</span>root@slave56 ~<span class="token punctuation">]</span><span class="token comment"># exit</span>
<span class="token builtin class-name">logout</span>
Connection to slave56 closed.
<span class="token punctuation">[</span>root@master55 /<span class="token punctuation">]</span><span class="token comment"># ssh root@slave57</span>
Last login: Tue Jun <span class="token number">16</span> <span class="token number">15</span>:11:23 <span class="token number">2020</span> from <span class="token number">192.168</span>.1.182
<span class="token punctuation">[</span>root@slave57 ~<span class="token punctuation">]</span><span class="token comment"># exit</span>
<span class="token builtin class-name">logout</span>
Connection to slave57 closed.
<span class="token punctuation">[</span>root@master55 /<span class="token punctuation">]</span><span class="token comment">#</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>slave56节点验证,第一次链接需要输入目标服务密码，后续则不用</p> <div class="language-shell script line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@slave56 ~<span class="token punctuation">]</span><span class="token comment"># ssh root@master55</span>
The authenticity of <span class="token function">host</span> <span class="token operator">&amp;</span><span class="token comment">#39;master55 (192.168.1.55)&amp;#39; can&amp;#39;t be established.</span>
ECDSA key fingerprint is SHA256:Dv4+42UAUC3FCEqZjwxJECtUHMgAYUtD2UsRASyffFw.
ECDSA key fingerprint is MD5:fe:0b:32:39:20:9c:e1:3e:67:b7:3d:42:a1:22:df:2a.
Are you sure you want to <span class="token builtin class-name">continue</span> connecting <span class="token punctuation">(</span>yes/no<span class="token punctuation">)</span>? <span class="token function">yes</span>
Warning: Permanently added <span class="token operator">&amp;</span><span class="token comment">#39;master55,192.168.1.55&amp;#39; (ECDSA) to the list of known hosts.</span>
Last login: Tue Jun <span class="token number">16</span> <span class="token number">15</span>:58:21 <span class="token number">2020</span> from <span class="token number">192.168</span>.1.182
<span class="token punctuation">[</span>root@master55 ~<span class="token punctuation">]</span><span class="token comment"># exit</span>
<span class="token builtin class-name">logout</span>
Connection to master55 closed.
<span class="token punctuation">[</span>root@slave56 ~<span class="token punctuation">]</span><span class="token comment"># ssh root@master55</span>
Last login: Tue Jun <span class="token number">16</span> <span class="token number">17</span>:17:38 <span class="token number">2020</span> from <span class="token number">192.168</span>.1.56
<span class="token punctuation">[</span>root@master55 ~<span class="token punctuation">]</span><span class="token comment"># exit</span>
<span class="token builtin class-name">logout</span>
Connection to master55 closed.
<span class="token punctuation">[</span>root@slave56 ~<span class="token punctuation">]</span><span class="token comment"># ssh root@slave57</span>
The authenticity of <span class="token function">host</span> <span class="token operator">&amp;</span><span class="token comment">#39;slave57 (192.168.1.57)&amp;#39; can&amp;#39;t be established.</span>
ECDSA key fingerprint is SHA256:Gfz+xXR217Yb2ZWOIMsRzSe+iynRvpxLnt98cI4kBRA.
ECDSA key fingerprint is MD5:8b:1d:cd:1d:24:79:de:80:c3:53:7c:d3:87:e0:d4:96.
Are you sure you want to <span class="token builtin class-name">continue</span> connecting <span class="token punctuation">(</span>yes/no<span class="token punctuation">)</span>? <span class="token function">yes</span>
Warning: Permanently added <span class="token operator">&amp;</span><span class="token comment">#39;slave57,192.168.1.57&amp;#39; (ECDSA) to the list of known hosts.</span>
Last login: Tue Jun <span class="token number">16</span> <span class="token number">17</span>:15:27 <span class="token number">2020</span> from <span class="token number">192.168</span>.1.55
<span class="token punctuation">[</span>root@slave57 ~<span class="token punctuation">]</span><span class="token comment"># exit</span>
<span class="token builtin class-name">logout</span>
Connection to slave57 closed.
<span class="token punctuation">[</span>root@slave56 ~<span class="token punctuation">]</span><span class="token comment"># ssh root@slave57</span>
Last login: Tue Jun <span class="token number">16</span> <span class="token number">17</span>:17:59 <span class="token number">2020</span> from <span class="token number">192.168</span>.1.56
<span class="token punctuation">[</span>root@slave57 ~<span class="token punctuation">]</span><span class="token comment"># exit</span>
<span class="token builtin class-name">logout</span>
Connection to slave57 closed.
<span class="token punctuation">[</span>root@slave56 ~<span class="token punctuation">]</span><span class="token comment">#</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><p>slave57节点验证,第一次链接需要输入目标服务密码，后续则不用</p> <div class="language-shell script line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@slave57 /<span class="token punctuation">]</span><span class="token comment"># ssh root@master55</span>
The authenticity of <span class="token function">host</span> <span class="token operator">&amp;</span><span class="token comment">#39;master55 (192.168.1.55)&amp;#39; can&amp;#39;t be established.</span>
ECDSA key fingerprint is SHA256:Dv4+42UAUC3FCEqZjwxJECtUHMgAYUtD2UsRASyffFw.
ECDSA key fingerprint is MD5:fe:0b:32:39:20:9c:e1:3e:67:b7:3d:42:a1:22:df:2a.
Are you sure you want to <span class="token builtin class-name">continue</span> connecting <span class="token punctuation">(</span>yes/no<span class="token punctuation">)</span>? <span class="token function">yes</span>
Warning: Permanently added <span class="token operator">&amp;</span><span class="token comment">#39;master55,192.168.1.55&amp;#39; (ECDSA) to the list of known hosts.</span>
Last login: Tue Jun <span class="token number">16</span> <span class="token number">17</span>:17:42 <span class="token number">2020</span> from <span class="token number">192.168</span>.1.56
<span class="token punctuation">[</span>root@master55 ~<span class="token punctuation">]</span><span class="token comment"># exit</span>
<span class="token builtin class-name">logout</span>
Connection to master55 closed.
<span class="token punctuation">[</span>root@slave57 yum.repos.d<span class="token punctuation">]</span><span class="token comment"># ssh root@master55</span>
Last login: Tue Jun <span class="token number">16</span> <span class="token number">17</span>:19:31 <span class="token number">2020</span> from <span class="token number">192.168</span>.1.57
<span class="token punctuation">[</span>root@master55 ~<span class="token punctuation">]</span><span class="token comment"># exit</span>
<span class="token builtin class-name">logout</span>
Connection to master55 closed.
<span class="token punctuation">[</span>root@slave57 yum.repos.d<span class="token punctuation">]</span><span class="token comment"># ssh root@slave56</span>
Last login: Tue Jun <span class="token number">16</span> <span class="token number">17</span>:15:11 <span class="token number">2020</span> from <span class="token number">192.168</span>.1.55
<span class="token punctuation">[</span>root@slave56 ~<span class="token punctuation">]</span><span class="token comment"># exit</span>
<span class="token builtin class-name">logout</span>
Connection to slave56 closed.
<span class="token punctuation">[</span>root@slave57 /<span class="token punctuation">]</span><span class="token comment">#</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h4 id="十、-三台服务器同时安装kubelet-kubeadm-kubectl"><a href="#十、-三台服务器同时安装kubelet-kubeadm-kubectl" class="header-anchor">#</a> 十、 三台服务器同时安装kubelet kubeadm kubectl</h4> <p>安装完成之后，启动，并设置开机启动</p> <div class="language-shell script line-numbers-mode"><pre class="language-shell"><code><span class="token function">sudo</span> yum <span class="token function">install</span> -y kubelet-1.18.2 kubeadm-1.18.2 kubectl-1.18.2
systemctl <span class="token builtin class-name">enable</span> kubelet <span class="token operator">&amp;</span>amp<span class="token punctuation">;</span><span class="token operator">&amp;</span>amp<span class="token punctuation">;</span> <span class="token function">sudo</span> systemctl start kubelet
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="十一、以master55为kubernetes主节点进行kubernetes初始化"><a href="#十一、以master55为kubernetes主节点进行kubernetes初始化" class="header-anchor">#</a> 十一、以master55为Kubernetes主节点进行Kubernetes初始化</h4> <ol><li>执行命令进行初始化
sudo kubeadm init &amp;minus;&amp;minus;image-repository registry.aliyuncs.com/google_containers &amp;minus;&amp;minus;kubernetes-version v1.18.2 &amp;minus;&amp;minus;apiserver-advertise-address 192.168.1.55 &amp;minus;&amp;minus;pod-network-cidr=10.244.0.0/16 &amp;minus;&amp;minus;token-ttl 0</li></ol> <div class="language-shell script line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@master55 /<span class="token punctuation">]</span><span class="token comment"># sudo kubeadm init --image-repository registry.aliyuncs.com/google_containers --kubernetes-version v1.18.2 --apiserver-advertise-address 192.168.1.55 --pod-network-cidr=10.244.0.0/16 --token-ttl 0</span>
W0616 <span class="token number">17</span>:24:47.742105    <span class="token number">8831</span> configset.go:202<span class="token punctuation">]</span> WARNING: kubeadm cannot validate component configs <span class="token keyword">for</span> API <span class="token function">groups</span> <span class="token punctuation">[</span>kubelet.config.k8s.io kubeproxy.config.k8s.io<span class="token punctuation">]</span>
<span class="token punctuation">[</span>init<span class="token punctuation">]</span> Using Kubernetes version: v1.18.2
<span class="token punctuation">[</span>preflight<span class="token punctuation">]</span> Running pre-flight checks
<span class="token punctuation">[</span>preflight<span class="token punctuation">]</span> Pulling images required <span class="token keyword">for</span> setting up a Kubernetes cluster
<span class="token punctuation">[</span>preflight<span class="token punctuation">]</span> This might take a minute or two, depending on the speed of your internet connection
<span class="token punctuation">[</span>preflight<span class="token punctuation">]</span> You can also perform this action <span class="token keyword">in</span> beforehand using <span class="token operator">&amp;</span><span class="token comment">#39;kubeadm config images pull&amp;#39;</span>
<span class="token punctuation">[</span>kubelet-start<span class="token punctuation">]</span> Writing kubelet environment <span class="token function">file</span> with flags to <span class="token function">file</span> <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>/var/lib/kubelet/kubeadm-flags.env<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>
<span class="token punctuation">[</span>kubelet-start<span class="token punctuation">]</span> Writing kubelet configuration to <span class="token function">file</span> <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>/var/lib/kubelet/config.yaml<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>
<span class="token punctuation">[</span>kubelet-start<span class="token punctuation">]</span> Starting the kubelet
<span class="token punctuation">[</span>certs<span class="token punctuation">]</span> Using certificateDir folder <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>/etc/kubernetes/pki<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>
<span class="token punctuation">[</span>certs<span class="token punctuation">]</span> Generating <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>ca<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span> certificate and key
<span class="token punctuation">[</span>certs<span class="token punctuation">]</span> Generating <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>apiserver<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span> certificate and key
<span class="token punctuation">[</span>certs<span class="token punctuation">]</span> apiserver serving cert is signed <span class="token keyword">for</span> DNS names <span class="token punctuation">[</span>master55.xincan.cn kubernetes kubernetes.default kubernetes.default.svc kubernetes.default.svc.cluster.local<span class="token punctuation">]</span> and IPs <span class="token punctuation">[</span><span class="token number">10.96</span>.0.1 <span class="token number">192.168</span>.1.55<span class="token punctuation">]</span>
<span class="token punctuation">[</span>certs<span class="token punctuation">]</span> Generating <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>apiserver-kubelet-client<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span> certificate and key
<span class="token punctuation">[</span>certs<span class="token punctuation">]</span> Generating <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>front-proxy-ca<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span> certificate and key
<span class="token punctuation">[</span>certs<span class="token punctuation">]</span> Generating <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>front-proxy-client<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span> certificate and key
<span class="token punctuation">[</span>certs<span class="token punctuation">]</span> Generating <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>etcd/ca<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span> certificate and key
<span class="token punctuation">[</span>certs<span class="token punctuation">]</span> Generating <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>etcd/server<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span> certificate and key
<span class="token punctuation">[</span>certs<span class="token punctuation">]</span> etcd/server serving cert is signed <span class="token keyword">for</span> DNS names <span class="token punctuation">[</span>master55.xincan.cn localhost<span class="token punctuation">]</span> and IPs <span class="token punctuation">[</span><span class="token number">192.168</span>.1.55 <span class="token number">127.0</span>.0.1 ::1<span class="token punctuation">]</span>
<span class="token punctuation">[</span>certs<span class="token punctuation">]</span> Generating <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>etcd/peer<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span> certificate and key
<span class="token punctuation">[</span>certs<span class="token punctuation">]</span> etcd/peer serving cert is signed <span class="token keyword">for</span> DNS names <span class="token punctuation">[</span>master55.xincan.cn localhost<span class="token punctuation">]</span> and IPs <span class="token punctuation">[</span><span class="token number">192.168</span>.1.55 <span class="token number">127.0</span>.0.1 ::1<span class="token punctuation">]</span>
<span class="token punctuation">[</span>certs<span class="token punctuation">]</span> Generating <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>etcd/healthcheck-client<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span> certificate and key
<span class="token punctuation">[</span>certs<span class="token punctuation">]</span> Generating <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>apiserver-etcd-client<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span> certificate and key
<span class="token punctuation">[</span>certs<span class="token punctuation">]</span> Generating <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>sa<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span> key and public key
<span class="token punctuation">[</span>kubeconfig<span class="token punctuation">]</span> Using kubeconfig folder <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>/etc/kubernetes<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>
<span class="token punctuation">[</span>kubeconfig<span class="token punctuation">]</span> Writing <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>admin.conf<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span> kubeconfig <span class="token function">file</span>
<span class="token punctuation">[</span>kubeconfig<span class="token punctuation">]</span> Writing <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>kubelet.conf<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span> kubeconfig <span class="token function">file</span>
<span class="token punctuation">[</span>kubeconfig<span class="token punctuation">]</span> Writing <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>controller-manager.conf<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span> kubeconfig <span class="token function">file</span>
<span class="token punctuation">[</span>kubeconfig<span class="token punctuation">]</span> Writing <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>scheduler.conf<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span> kubeconfig <span class="token function">file</span>
<span class="token punctuation">[</span>control-plane<span class="token punctuation">]</span> Using manifest folder <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>/etc/kubernetes/manifests<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>
<span class="token punctuation">[</span>control-plane<span class="token punctuation">]</span> Creating static Pod manifest <span class="token keyword">for</span> <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>kube-apiserver<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>
<span class="token punctuation">[</span>control-plane<span class="token punctuation">]</span> Creating static Pod manifest <span class="token keyword">for</span> <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>kube-controller-manager<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>
W0616 <span class="token number">17</span>:29:47.640484    <span class="token number">8831</span> manifests.go:225<span class="token punctuation">]</span> the default kube-apiserver authorization-mode is <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>Node,RBAC<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token punctuation">;</span> using <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>Node,RBAC<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>
<span class="token punctuation">[</span>control-plane<span class="token punctuation">]</span> Creating static Pod manifest <span class="token keyword">for</span> <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>kube-scheduler<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>
W0616 <span class="token number">17</span>:29:47.646613    <span class="token number">8831</span> manifests.go:225<span class="token punctuation">]</span> the default kube-apiserver authorization-mode is <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>Node,RBAC<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token punctuation">;</span> using <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>Node,RBAC<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>
<span class="token punctuation">[</span>etcd<span class="token punctuation">]</span> Creating static Pod manifest <span class="token keyword">for</span> <span class="token builtin class-name">local</span> etcd <span class="token keyword">in</span> <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>/etc/kubernetes/manifests<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>
<span class="token punctuation">[</span>wait-control-plane<span class="token punctuation">]</span> Waiting <span class="token keyword">for</span> the kubelet to boot up the control plane as static Pods from directory <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>/etc/kubernetes/manifests<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token builtin class-name">.</span> This can take up to 4m0s
<span class="token punctuation">[</span>apiclient<span class="token punctuation">]</span> All control plane components are healthy after <span class="token number">31.505848</span> seconds
<span class="token punctuation">[</span>upload-config<span class="token punctuation">]</span> Storing the configuration used <span class="token keyword">in</span> ConfigMap <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>kubeadm-config<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span> <span class="token keyword">in</span> the <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>kube-system<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span> Namespace
<span class="token punctuation">[</span>kubelet<span class="token punctuation">]</span> Creating a ConfigMap <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>kubelet-config-1.18<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span> <span class="token keyword">in</span> namespace kube-system with the configuration <span class="token keyword">for</span> the kubelets <span class="token keyword">in</span> the cluster
<span class="token punctuation">[</span>upload-certs<span class="token punctuation">]</span> Skipping phase. Please see --upload-certs
<span class="token punctuation">[</span>mark-control-plane<span class="token punctuation">]</span> Marking the node master55.xincan.cn as control-plane by adding the label <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>node-role.kubernetes.io/master<span class="token operator">=</span><span class="token operator">&amp;</span><span class="token comment">#39;&amp;#39;&amp;quot;</span>
<span class="token punctuation">[</span>mark-control-plane<span class="token punctuation">]</span> Marking the node master55.xincan.cn as control-plane by adding the taints <span class="token punctuation">[</span>node-role.kubernetes.io/master:NoSchedule<span class="token punctuation">]</span>
<span class="token punctuation">[</span>bootstrap-token<span class="token punctuation">]</span> Using token: 991hr9.scqkkyphn1cjjcl7
<span class="token punctuation">[</span>bootstrap-token<span class="token punctuation">]</span> Configuring bootstrap tokens, cluster-info ConfigMap, RBAC Roles
<span class="token punctuation">[</span>bootstrap-token<span class="token punctuation">]</span> configured RBAC rules to allow Node Bootstrap tokens to get nodes
<span class="token punctuation">[</span>bootstrap-token<span class="token punctuation">]</span> configured RBAC rules to allow Node Bootstrap tokens to post CSRs <span class="token keyword">in</span> order <span class="token keyword">for</span> nodes to get long term certificate credentials
<span class="token punctuation">[</span>bootstrap-token<span class="token punctuation">]</span> configured RBAC rules to allow the csrapprover controller automatically approve CSRs from a Node Bootstrap Token
<span class="token punctuation">[</span>bootstrap-token<span class="token punctuation">]</span> configured RBAC rules to allow certificate rotation <span class="token keyword">for</span> all node client certificates <span class="token keyword">in</span> the cluster
<span class="token punctuation">[</span>bootstrap-token<span class="token punctuation">]</span> Creating the <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>cluster-info<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span> ConfigMap <span class="token keyword">in</span> the <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>kube-public<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span> namespace
<span class="token punctuation">[</span>kubelet-finalize<span class="token punctuation">]</span> Updating <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>/etc/kubernetes/kubelet.conf<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span> to point to a rotatable kubelet client certificate and key
<span class="token punctuation">[</span>addons<span class="token punctuation">]</span> Applied essential addon: CoreDNS
<span class="token punctuation">[</span>addons<span class="token punctuation">]</span> Applied essential addon: kube-proxy

Your Kubernetes control-plane has initialized successfully<span class="token operator">!</span>

To start using your cluster, you need to run the following as a regular user:

  <span class="token function">mkdir</span> -p <span class="token environment constant">$HOME</span>/.kube
  <span class="token function">sudo</span> <span class="token function">cp</span> -i /etc/kubernetes/admin.conf <span class="token environment constant">$HOME</span>/.kube/config
  <span class="token function">sudo</span> <span class="token function">chown</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">id</span> -u<span class="token variable">)</span></span><span class="token builtin class-name">:</span><span class="token variable"><span class="token variable">$(</span><span class="token function">id</span> -g<span class="token variable">)</span></span> <span class="token environment constant">$HOME</span>/.kube/config

You should now deploy a pod network to the cluster.
Run <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>kubectl apply -f <span class="token punctuation">[</span>podnetwork<span class="token punctuation">]</span>.yaml<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span> with one of the options listed at:
  https://kubernetes.io/docs/concepts/cluster-administration/addons/

Then you can <span class="token function">join</span> any number of worker nodes by running the following on each as root:

kubeadm <span class="token function">join</span> <span class="token number">192.168</span>.1.55:6443 --token 991hr9.scqkkyphn1cjjcl7 <span class="token punctuation">\</span>
    --discovery-token-ca-cert-hash sha256:1dcf2607e09f83160ce9bc99a941d9a6bd74e99b6b8d3adb63af800ffee19baf
<span class="token punctuation">[</span>root@master55 /<span class="token punctuation">]</span><span class="token comment">#</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br></div></div><ol start="2"><li>根据初始化提示，在master55节点上执行如下命令
mkdir -p $HOME/.kube
sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
sudo chown $(id -u)😒(id -g) $HOME/.kube/config</li></ol> <div class="language-shell script line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@master55 /<span class="token punctuation">]</span><span class="token comment"># mkdir -p $HOME/.kube</span>
<span class="token punctuation">[</span>root@master55 /<span class="token punctuation">]</span><span class="token comment"># sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config</span>
<span class="token punctuation">[</span>root@master55 /<span class="token punctuation">]</span><span class="token comment"># sudo chown $(id -u):$(id -g) $HOME/.kube/config</span>
<span class="token punctuation">[</span>root@master55 /<span class="token punctuation">]</span><span class="token comment">#</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ol start="3"><li>根据初始化提示，在slave56、slave57节点上分别执行如下命令
kubeadm join 192.168.1.55:6443 &amp;minus;&amp;minus;token 991hr9.scqkkyphn1cjjcl7 &amp;minus;&amp;minus;discovery-token-ca-cert-hash sha256:1dcf2607e09f83160ce9bc99a941d9a6bd74e99b6b8d3adb63af800ffee19baf</li></ol> <div class="language-shell script line-numbers-mode"><pre class="language-shell"><code>W0616 <span class="token number">17</span>:50:09.914108    <span class="token number">4585</span> join.go:346<span class="token punctuation">]</span> <span class="token punctuation">[</span>preflight<span class="token punctuation">]</span> WARNING: JoinControlPane.controlPlane settings will be ignored when control-plane flag is not set.
<span class="token punctuation">[</span>preflight<span class="token punctuation">]</span> Running pre-flight checks
<span class="token punctuation">[</span>preflight<span class="token punctuation">]</span> Reading configuration from the cluster<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>preflight<span class="token punctuation">]</span> FYI: You can <span class="token function">look</span> at this config <span class="token function">file</span> with <span class="token operator">&amp;</span><span class="token comment">#39;kubectl -n kube-system get cm kubeadm-config -oyaml&amp;#39;</span>
<span class="token punctuation">[</span>kubelet-start<span class="token punctuation">]</span> Downloading configuration <span class="token keyword">for</span> the kubelet from the <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>kubelet-config-1.18<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span> ConfigMap <span class="token keyword">in</span> the kube-system namespace
<span class="token punctuation">[</span>kubelet-start<span class="token punctuation">]</span> Writing kubelet configuration to <span class="token function">file</span> <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>/var/lib/kubelet/config.yaml<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>
<span class="token punctuation">[</span>kubelet-start<span class="token punctuation">]</span> Writing kubelet environment <span class="token function">file</span> with flags to <span class="token function">file</span> <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>/var/lib/kubelet/kubeadm-flags.env<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>
<span class="token punctuation">[</span>kubelet-start<span class="token punctuation">]</span> Starting the kubelet
<span class="token punctuation">[</span>kubelet-start<span class="token punctuation">]</span> Waiting <span class="token keyword">for</span> the kubelet to perform the TLS Bootstrap<span class="token punctuation">..</span>.

This node has joined the cluster:
* Certificate signing request was sent to apiserver and a response was received.
* The Kubelet was informed of the new secure connection details.

Run <span class="token operator">&amp;</span><span class="token comment">#39;kubectl get nodes&amp;#39; on the control-plane to see this node join the cluster.</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h4 id="十二、kubernetes命令自动补全（墙裂建议）"><a href="#十二、kubernetes命令自动补全（墙裂建议）" class="header-anchor">#</a> 十二、Kubernetes命令自动补全（墙裂建议）</h4> <div class="language-SHELL SCRIPT line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@master55 ~<span class="token punctuation">]</span><span class="token comment"># yum install -y epel-release bash-completion</span>
Loaded plugins: fastestmirror
Loading mirror speeds from cached hostfile
 * base: mirrors.aliyun.com
 * extras: mirrors.aliyun.com
 * updates: mirrors.aliyun.com
kubernetes/signature                                                                                                                                                   <span class="token operator">|</span>  <span class="token number">454</span> B  00:00:00
kubernetes/signature                                                                                                                                                   <span class="token operator">|</span> <span class="token number">1.4</span> kB  00:00:00 <span class="token operator">!</span><span class="token operator">!</span><span class="token operator">!</span>
Resolving Dependencies
--<span class="token operator">&amp;</span>gt<span class="token punctuation">;</span> Running transaction check
---<span class="token operator">&amp;</span>gt<span class="token punctuation">;</span> Package bash-completion.noarch <span class="token number">1</span>:2.1-6.el7 will be updated
---<span class="token operator">&amp;</span>gt<span class="token punctuation">;</span> Package bash-completion.noarch <span class="token number">1</span>:2.1-8.el7 will be an update
---<span class="token operator">&amp;</span>gt<span class="token punctuation">;</span> Package epel-release.noarch <span class="token number">0</span>:7-11 will be installed
--<span class="token operator">&amp;</span>gt<span class="token punctuation">;</span> Finished Dependency Resolution

Dependencies Resolved

<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
 Package                                            Arch                                      Version                                         Repository                                 Size
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
Installing:
 epel-release                                       noarch                                    <span class="token number">7</span>-11                                            extras                                     <span class="token number">15</span> k
Updating:
 bash-completion                                    noarch                                    <span class="token number">1</span>:2.1-8.el7                                     base                                       <span class="token number">87</span> k

Transaction Summary
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
Install  <span class="token number">1</span> Package
Upgrade  <span class="token number">1</span> Package

Total download size: <span class="token number">101</span> k
Downloading packages:
No Presto metadata available <span class="token keyword">for</span> base
<span class="token punctuation">(</span><span class="token number">1</span>/2<span class="token punctuation">)</span>: bash-completion-2.1-8.el7.noarch.rpm                                                                                                                            <span class="token operator">|</span>  <span class="token number">87</span> kB  00:00:00
<span class="token punctuation">(</span><span class="token number">2</span>/2<span class="token punctuation">)</span>: epel-release-7-11.noarch.rpm                                                                                                                                    <span class="token operator">|</span>  <span class="token number">15</span> kB  00:00:00
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Total                                                                                                                                                         <span class="token number">225</span> kB/s <span class="token operator">|</span> <span class="token number">101</span> kB  00:00:00
Running transaction check
Running transaction <span class="token builtin class-name">test</span>
Transaction <span class="token builtin class-name">test</span> succeeded
Running transaction
  Installing <span class="token builtin class-name">:</span> epel-release-7-11.noarch                                                                                                                                                   <span class="token number">1</span>/3
  Updating   <span class="token builtin class-name">:</span> <span class="token number">1</span>:bash-completion-2.1-8.el7.noarch                                                                                                                                         <span class="token number">2</span>/3
  Cleanup    <span class="token builtin class-name">:</span> <span class="token number">1</span>:bash-completion-2.1-6.el7.noarch                                                                                                                                         <span class="token number">3</span>/3
  Verifying  <span class="token builtin class-name">:</span> <span class="token number">1</span>:bash-completion-2.1-8.el7.noarch                                                                                                                                         <span class="token number">1</span>/3
  Verifying  <span class="token builtin class-name">:</span> epel-release-7-11.noarch                                                                                                                                                   <span class="token number">2</span>/3
  Verifying  <span class="token builtin class-name">:</span> <span class="token number">1</span>:bash-completion-2.1-6.el7.noarch                                                                                                                                         <span class="token number">3</span>/3

Installed:
  epel-release.noarch <span class="token number">0</span>:7-11

Updated:
  bash-completion.noarch <span class="token number">1</span>:2.1-8.el7

Complete<span class="token operator">!</span>
<span class="token punctuation">[</span>root@master55 ~<span class="token punctuation">]</span><span class="token comment"># source /usr/share/bash-completion/bash_completion</span>
<span class="token punctuation">[</span>root@master55 ~<span class="token punctuation">]</span><span class="token comment">#</span>
<span class="token punctuation">[</span>root@master55 ~<span class="token punctuation">]</span><span class="token comment"># source &amp;lt;(kubectl completion bash)</span>
<span class="token punctuation">[</span>root@master55 ~<span class="token punctuation">]</span><span class="token comment">#</span>
<span class="token punctuation">[</span>root@master55 ~<span class="token punctuation">]</span><span class="token comment"># echo &amp;quot;source &amp;lt;(kubectl completion bash)&amp;quot; &amp;gt;&amp;gt; ~/.bashrc</span>
// 输入kubectl, 双击Tab
<span class="token punctuation">[</span>root@master55 ~<span class="token punctuation">]</span><span class="token comment"># kubectl</span>
alpha          apply          certificate    convert        delete         edit           get            options        proxy          scale          uncordon
annotate       attach         cluster-info   cordon         describe       <span class="token builtin class-name">exec</span>           kustomize      patch          replace        <span class="token builtin class-name">set</span>            version
api-resources  auth           completion     <span class="token function">cp</span>             <span class="token function">diff</span>           explain        label          plugin         rollout        taint          <span class="token function">wait</span>
api-versions   autoscale      config         create         drain          expose         logs           port-forward   run            <span class="token function">top</span>
<span class="token punctuation">[</span>root@master55 ~<span class="token punctuation">]</span><span class="token comment"># kubectl</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br></div></div><h4 id="十三、k8s查看所有节点"><a href="#十三、k8s查看所有节点" class="header-anchor">#</a> 十三、k8s查看所有节点</h4> <p>master55节点查看所有节点，当前三台服务器的状态都是NotReady</p> <div class="language-shell script line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@master55 /<span class="token punctuation">]</span><span class="token comment"># kubectl get nodes</span>
NAME                 STATUS     ROLES    AGE   VERSION
master55.xincan.cn   NotReady   master   16h   v1.18.3
slave56.xincan.cn    NotReady   <span class="token operator">&amp;</span>lt<span class="token punctuation">;</span>none<span class="token operator">&amp;</span>gt<span class="token punctuation">;</span>   15h   v1.18.3
slave57.xincan.cn    NotReady   <span class="token operator">&amp;</span>lt<span class="token punctuation">;</span>none<span class="token operator">&amp;</span>gt<span class="token punctuation">;</span>   16h   v1.18.3
<span class="token punctuation">[</span>root@master55 /<span class="token punctuation">]</span><span class="token comment">#</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="十四、k8s查看所有命名空间下所有pod"><a href="#十四、k8s查看所有命名空间下所有pod" class="header-anchor">#</a> 十四、k8s查看所有命名空间下所有pod</h4> <p>发现coredns一直处在pending状态，需要安装k8s网络插件</p> <div class="language-shell script line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@master55 /<span class="token punctuation">]</span><span class="token comment"># kubectl get pod --all-namespaces</span>
NAMESPACE     NAME                                         READY   STATUS    RESTARTS   AGE
kube-system   coredns-7ff77c879f-hz59h                     <span class="token number">0</span>/1     Pending   <span class="token number">0</span>          16h
kube-system   coredns-7ff77c879f-kkdpn                     <span class="token number">0</span>/1     Pending   <span class="token number">0</span>          16h
kube-system   etcd-master55.xincan.cn                      <span class="token number">1</span>/1     Running   <span class="token number">2</span>          16h
kube-system   kube-apiserver-master55.xincan.cn            <span class="token number">1</span>/1     Running   <span class="token number">2</span>          16h
kube-system   kube-controller-manager-master55.xincan.cn   <span class="token number">1</span>/1     Running   <span class="token number">2</span>          16h
kube-system   kube-proxy-kdxlv                             <span class="token number">1</span>/1     Running   <span class="token number">2</span>          16h
kube-system   kube-proxy-mxm5n                             <span class="token number">1</span>/1     Running   <span class="token number">2</span>          16h
kube-system   kube-proxy-sdnxb                             <span class="token number">1</span>/1     Running   <span class="token number">2</span>          15h
kube-system   kube-scheduler-master55.xincan.cn            <span class="token number">1</span>/1     Running   <span class="token number">2</span>          16h
<span class="token punctuation">[</span>root@master55 /<span class="token punctuation">]</span><span class="token comment">#</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h4 id="十五、k8s安装网络插件"><a href="#十五、k8s安装网络插件" class="header-anchor">#</a> 十五、k8s安装网络插件</h4> <p>我们这里选取calico网络插件（提供企业级支持）</p> <ol><li>在master55节点上创建文件夹，用于存放下载的网络插件，我这里下载的是calico-3.13.1.yaml</li></ol> <div class="language-shell script line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@master55 /<span class="token punctuation">]</span><span class="token comment"># mkdir k8s</span>
<span class="token punctuation">[</span>root@master55 /<span class="token punctuation">]</span><span class="token comment"># cd k8s/</span>
<span class="token punctuation">[</span>root@master55 k8s<span class="token punctuation">]</span><span class="token comment"># mkdir calico &amp;amp;&amp;amp; cd calico</span>
<span class="token punctuation">[</span>root@master55 calico<span class="token punctuation">]</span><span class="token comment"># wget https://kuboard.cn/install-script/calico/calico-3.13.1.yaml</span>
--2020-06-17 <span class="token number">17</span>:42:44--  https://kuboard.cn/install-script/calico/calico-3.13.1.yaml
Resolving kuboard.cn <span class="token punctuation">(</span>kuboard.cn<span class="token punctuation">)</span><span class="token punctuation">..</span>. <span class="token number">119.3</span>.92.138, <span class="token number">122.112</span>.240.69
Connecting to kuboard.cn <span class="token punctuation">(</span>kuboard.cn<span class="token punctuation">)</span><span class="token operator">|</span><span class="token number">119.3</span>.92.138<span class="token operator">|</span>:443<span class="token punctuation">..</span>. connected.
HTTP request sent, awaiting response<span class="token punctuation">..</span>. <span class="token number">200</span> OK
Length: <span class="token number">21079</span> <span class="token punctuation">(</span>21K<span class="token punctuation">)</span> <span class="token punctuation">[</span>application/octet-stream<span class="token punctuation">]</span>
Saving to: ‘calico-3.13.1.yaml’

<span class="token number">100</span>%<span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">&amp;</span>gt<span class="token punctuation">;</span><span class="token punctuation">]</span> <span class="token number">21,079</span>      --.-K/s   <span class="token keyword">in</span> 0s

<span class="token number">2020</span>-06-17 <span class="token number">17</span>:42:51 <span class="token punctuation">(</span><span class="token number">221</span> MB/s<span class="token punctuation">)</span> - ‘calico-3.13.1.yaml’ saved <span class="token punctuation">[</span><span class="token number">21079</span>/21079<span class="token punctuation">]</span>

<span class="token punctuation">[</span>root@master55 calico<span class="token punctuation">]</span><span class="token comment"># ls</span>
calico-3.13.1.yaml
<span class="token punctuation">[</span>root@master55 calico<span class="token punctuation">]</span><span class="token comment">#</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><ol start="2"><li>安装calico-3.13.1.yaml</li></ol> <div class="language-shell script line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@master55 calico<span class="token punctuation">]</span><span class="token comment"># kubectl apply -f calico-3.13.1.yaml</span>
configmap/calico-config created
customresourcedefinition.apiextensions.k8s.io/bgpconfigurations.crd.projectcalico.org created
customresourcedefinition.apiextensions.k8s.io/bgppeers.crd.projectcalico.org created
customresourcedefinition.apiextensions.k8s.io/blockaffinities.crd.projectcalico.org created
customresourcedefinition.apiextensions.k8s.io/clusterinformations.crd.projectcalico.org created
customresourcedefinition.apiextensions.k8s.io/felixconfigurations.crd.projectcalico.org created
customresourcedefinition.apiextensions.k8s.io/globalnetworkpolicies.crd.projectcalico.org created
customresourcedefinition.apiextensions.k8s.io/globalnetworksets.crd.projectcalico.org created
customresourcedefinition.apiextensions.k8s.io/hostendpoints.crd.projectcalico.org created
customresourcedefinition.apiextensions.k8s.io/ipamblocks.crd.projectcalico.org created
customresourcedefinition.apiextensions.k8s.io/ipamconfigs.crd.projectcalico.org created
customresourcedefinition.apiextensions.k8s.io/ipamhandles.crd.projectcalico.org created
customresourcedefinition.apiextensions.k8s.io/ippools.crd.projectcalico.org created
customresourcedefinition.apiextensions.k8s.io/networkpolicies.crd.projectcalico.org created
customresourcedefinition.apiextensions.k8s.io/networksets.crd.projectcalico.org created
clusterrole.rbac.authorization.k8s.io/calico-kube-controllers created
clusterrolebinding.rbac.authorization.k8s.io/calico-kube-controllers created
clusterrole.rbac.authorization.k8s.io/calico-node created
clusterrolebinding.rbac.authorization.k8s.io/calico-node created
daemonset.apps/calico-node created
serviceaccount/calico-node created
deployment.apps/calico-kube-controllers created
serviceaccount/calico-kube-controllers created
<span class="token punctuation">[</span>root@master55 calico<span class="token punctuation">]</span><span class="token comment">#</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><h4 id="十六、再次查看node和pod"><a href="#十六、再次查看node和pod" class="header-anchor">#</a> 十六、再次查看node和pod</h4> <p>需要等待一会时间</p> <ol><li>查看nodes，发现状态已经为Ready</li></ol> <div class="language-shell script line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@master55 /<span class="token punctuation">]</span><span class="token comment"># kubectl get nodes</span>
NAME                 STATUS   ROLES    AGE   VERSION
master55.xincan.cn   Ready    master   16h   v1.18.3
slave56.xincan.cn    Ready    <span class="token operator">&amp;</span>lt<span class="token punctuation">;</span>none<span class="token operator">&amp;</span>gt<span class="token punctuation">;</span>   16h   v1.18.3
slave57.xincan.cn    Ready    <span class="token operator">&amp;</span>lt<span class="token punctuation">;</span>none<span class="token operator">&amp;</span>gt<span class="token punctuation">;</span>   16h   v1.18.3
<span class="token punctuation">[</span>root@master55 /<span class="token punctuation">]</span><span class="token comment"># </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ol start="2"><li>查看pods，发现状态都为Running</li></ol> <div class="language-shell script line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@master55 /<span class="token punctuation">]</span><span class="token comment"># kubectl get pod --all-namespaces</span>
NAMESPACE     NAME                                         READY   STATUS    RESTARTS   AGE
kube-system   calico-kube-controllers-5b8b769fcd-cbqpr     <span class="token number">1</span>/1     Running   <span class="token number">0</span>          6m21s
kube-system   calico-node-fnv55                            <span class="token number">1</span>/1     Running   <span class="token number">0</span>          6m21s
kube-system   calico-node-rbpc8                            <span class="token number">1</span>/1     Running   <span class="token number">0</span>          6m21s
kube-system   calico-node-xrsbf                            <span class="token number">1</span>/1     Running   <span class="token number">0</span>          6m21s
kube-system   coredns-7ff77c879f-hz59h                     <span class="token number">1</span>/1     Running   <span class="token number">0</span>          16h
kube-system   coredns-7ff77c879f-kkdpn                     <span class="token number">1</span>/1     Running   <span class="token number">0</span>          16h
kube-system   etcd-master55.xincan.cn                      <span class="token number">1</span>/1     Running   <span class="token number">2</span>          16h
kube-system   kube-apiserver-master55.xincan.cn            <span class="token number">1</span>/1     Running   <span class="token number">2</span>          16h
kube-system   kube-controller-manager-master55.xincan.cn   <span class="token number">1</span>/1     Running   <span class="token number">2</span>          16h
kube-system   kube-proxy-kdxlv                             <span class="token number">1</span>/1     Running   <span class="token number">2</span>          16h
kube-system   kube-proxy-mxm5n                             <span class="token number">1</span>/1     Running   <span class="token number">2</span>          16h
kube-system   kube-proxy-sdnxb                             <span class="token number">1</span>/1     Running   <span class="token number">2</span>          16h
kube-system   kube-scheduler-master55.xincan.cn            <span class="token number">1</span>/1     Running   <span class="token number">2</span>          16h
<span class="token punctuation">[</span>root@master55 /<span class="token punctuation">]</span><span class="token comment"># </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h4 id="十七、安装git"><a href="#十七、安装git" class="header-anchor">#</a> 十七、安装git</h4> <div class="language-shell script line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@master55 /<span class="token punctuation">]</span><span class="token comment"># yum install curl-devel expat-devel gettext-devel openssl-devel zlib-devel gcc perl-ExtUtils-MakeMaker</span>
<span class="token punctuation">[</span>root@master55 /<span class="token punctuation">]</span><span class="token comment"># cd /usr/local/src/</span>
<span class="token punctuation">[</span>root@master55 src<span class="token punctuation">]</span><span class="token comment"># wget https://mirrors.edge.kernel.org/pub/software/scm/git/git-2.23.0.tar.xz</span>
<span class="token punctuation">[</span>root@master55 src<span class="token punctuation">]</span><span class="token comment"># tar -xvf git-2.23.0.tar.xz</span>
<span class="token punctuation">[</span>root@master55 src<span class="token punctuation">]</span><span class="token comment"># cd git-2.23.0/</span>
<span class="token punctuation">[</span>root@master55 src<span class="token punctuation">]</span><span class="token comment"># make prefix=/usr/local/git all</span>
<span class="token punctuation">[</span>root@master55 src<span class="token punctuation">]</span><span class="token comment"># make prefix=/usr/local/git install</span>
<span class="token punctuation">[</span>root@master55 src<span class="token punctuation">]</span><span class="token comment"># echo &amp;quot;export PATH=$PATH:/usr/local/git/bin&amp;quot; &amp;gt;&amp;gt; /etc/profile</span>
<span class="token punctuation">[</span>root@master55 src<span class="token punctuation">]</span><span class="token comment"># source  /etc/profile</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h4 id="十八、kube-promethues部署"><a href="#十八、kube-promethues部署" class="header-anchor">#</a> 十八、kube-promethues部署</h4> <ol><li>下载安装源码，切换到上述创建的k8s目录下，进行git clone https://github.com/coreos/kube-prometheus.git拉取</li> <li>安装文件都在kube-prometheus/manifests/ 目录下，切换到此目录</li></ol> <div class="language-shell script line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@master55 k8s<span class="token punctuation">]</span><span class="token comment"># git clone https://github.com/coreos/kube-prometheus.git</span>
Cloning into <span class="token operator">&amp;</span><span class="token comment">#39;kube-prometheus&amp;#39;...</span>
remote: Enumerating objects: <span class="token number">8381</span>, done.
remote: Total <span class="token number">8381</span> <span class="token punctuation">(</span>delta <span class="token number">0</span><span class="token punctuation">)</span>, reused <span class="token number">0</span> <span class="token punctuation">(</span>delta <span class="token number">0</span><span class="token punctuation">)</span>, pack-reused <span class="token number">8381</span>
Receiving objects: <span class="token number">100</span>% <span class="token punctuation">(</span><span class="token number">8381</span>/8381<span class="token punctuation">)</span>, <span class="token number">4.70</span> MiB <span class="token operator">|</span> <span class="token number">421.00</span> KiB/s, done.
Resolving deltas: <span class="token number">100</span>% <span class="token punctuation">(</span><span class="token number">5082</span>/5082<span class="token punctuation">)</span>, done.
<span class="token punctuation">[</span>root@master55 k8s<span class="token punctuation">]</span><span class="token comment"># ls</span>
calico  kube-prometheus
<span class="token punctuation">[</span>root@master55 k8s<span class="token punctuation">]</span><span class="token comment"># cd kube-prometheus/manifests/</span>
<span class="token punctuation">[</span>root@master55 manifests<span class="token punctuation">]</span><span class="token comment"># ls</span>
alertmanager-alertmanager.yaml              node-exporter-clusterRoleBinding.yaml                       prometheus-clusterRole.yaml
alertmanager-secret.yaml                    node-exporter-clusterRole.yaml                              prometheus-operator-serviceMonitor.yaml
alertmanager-serviceAccount.yaml            node-exporter-daemonset.yaml                                prometheus-prometheus.yaml
alertmanager-serviceMonitor.yaml            node-exporter-serviceAccount.yaml                           prometheus-roleBindingConfig.yaml
alertmanager-service.yaml                   node-exporter-serviceMonitor.yaml                           prometheus-roleBindingSpecificNamespaces.yaml
grafana-dashboardDatasources.yaml           node-exporter-service.yaml                                  prometheus-roleConfig.yaml
grafana-dashboardDefinitions.yaml           prometheus-adapter-apiService.yaml                          prometheus-roleSpecificNamespaces.yaml
grafana-dashboardSources.yaml               prometheus-adapter-clusterRoleAggregatedMetricsReader.yaml  prometheus-rules.yaml
grafana-deployment.yaml                     prometheus-adapter-clusterRoleBindingDelegator.yaml         prometheus-serviceAccount.yaml
grafana-serviceAccount.yaml                 prometheus-adapter-clusterRoleBinding.yaml                  prometheus-serviceMonitorApiserver.yaml
grafana-serviceMonitor.yaml                 prometheus-adapter-clusterRoleServerResources.yaml          prometheus-serviceMonitorCoreDNS.yaml
grafana-service.yaml                        prometheus-adapter-clusterRole.yaml                         prometheus-serviceMonitorKubeControllerManager.yaml
kube-state-metrics-clusterRoleBinding.yaml  prometheus-adapter-configMap.yaml                           prometheus-serviceMonitorKubelet.yaml
kube-state-metrics-clusterRole.yaml         prometheus-adapter-deployment.yaml                          prometheus-serviceMonitorKubeScheduler.yaml
kube-state-metrics-deployment.yaml          prometheus-adapter-roleBindingAuthReader.yaml               prometheus-serviceMonitor.yaml
kube-state-metrics-serviceAccount.yaml      prometheus-adapter-serviceAccount.yaml                      prometheus-service.yaml
kube-state-metrics-serviceMonitor.yaml      prometheus-adapter-service.yaml                             setup
kube-state-metrics-service.yaml             prometheus-clusterRoleBinding.yaml
<span class="token punctuation">[</span>root@master55 manifests<span class="token punctuation">]</span><span class="token comment">#</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><ol start="3"><li>官方把所有文件都放在一起,这里我复制了然后分类下，切换到k8s目录下进行操作</li></ol> <div class="language-shell script line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@master55 k8s<span class="token punctuation">]</span><span class="token comment"># mkdir prometheus</span>
<span class="token punctuation">[</span>root@master55 k8s<span class="token punctuation">]</span><span class="token comment"># cp kube-prometheus/manifests/* prometheus/</span>
<span class="token punctuation">[</span>root@master55 k8s<span class="token punctuation">]</span><span class="token comment"># cd prometheus/</span>
<span class="token punctuation">[</span>root@master55 prometheus<span class="token punctuation">]</span><span class="token comment"># mkdir -p operator node-exporter alertmanager grafana kube-state-metrics prometheus serviceMonitor adapter</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ol start="4"><li>将kube-prometheus/manifests/setup下的文件都复制到/prometheus/operator/下</li></ol> <div class="language-shell script line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@master55 k8s<span class="token punctuation">]</span><span class="token comment"># cp -f kube-prometheus/manifests/setup/* /k8s/prometheus/operator/</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ol start="5"><li>将prometheus/operator/下0namespace-namespace.yaml文件移动到/k8s/prometheus/下</li></ol> <div class="language-shell script line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@master55 k8s<span class="token punctuation">]</span><span class="token comment"># mv prometheus/operator/0namespace-namespace.yaml prometheus/</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ol start="6"><li>切换到prometheus/目录下，进行文件归置</li></ol> <div class="language-shell script line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@master55 k8s<span class="token punctuation">]</span><span class="token comment"># cd prometheus/</span>
<span class="token punctuation">[</span>root@master55 prometheus<span class="token punctuation">]</span><span class="token comment"># mv *-serviceMonitor* serviceMonitor/</span>
<span class="token punctuation">[</span>root@master55 prometheus<span class="token punctuation">]</span><span class="token comment"># mv grafana-* grafana/</span>
<span class="token punctuation">[</span>root@master55 prometheus<span class="token punctuation">]</span><span class="token comment"># mv kube-state-metrics-* kube-state-metrics/</span>
<span class="token punctuation">[</span>root@master55 prometheus<span class="token punctuation">]</span><span class="token comment"># mv alertmanager-* alertmanager/</span>
<span class="token punctuation">[</span>root@master55 prometheus<span class="token punctuation">]</span><span class="token comment"># mv node-exporter-* node-exporter/</span>
<span class="token punctuation">[</span>root@master55 prometheus<span class="token punctuation">]</span><span class="token comment"># mv prometheus-adapter* adapter/</span>
<span class="token punctuation">[</span>root@master55 prometheus<span class="token punctuation">]</span><span class="token comment"># mv prometheus-* prometheus/</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><ol start="7"><li>注意：新版本的默认label变了，需要修改选择器为beta.kubernetes.io/os，不然安装的时候会卡住,修改选择器</li></ol> <div class="language-shell script line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@master55 prometheus<span class="token punctuation">]</span><span class="token comment"># sed -ri &amp;#39;/linux/s#kubernetes.io#beta.&amp;amp;#&amp;#39; \</span>
     alertmanager/alertmanager-alertmanager.yaml <span class="token punctuation">\</span>
     prometheus/prometheus-prometheus.yaml <span class="token punctuation">\</span>
     node-exporter/node-exporter-daemonset.yaml <span class="token punctuation">\</span>
     kube-state-metrics/kube-state-metrics-deployment.yaml
<span class="token punctuation">[</span>root@master55 prometheus<span class="token punctuation">]</span><span class="token comment">#</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ol start="7"><li>注意：镜像使用dockerhub上的</li></ol> <div class="language-shell script line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@master55 prometheus<span class="token punctuation">]</span><span class="token comment"># sed -ri &amp;#39;/quay.io/s#quay.io/prometheus#prom#&amp;#39; \</span>
  alertmanager/alertmanager-alertmanager.yaml <span class="token punctuation">\</span>
  prometheus/prometheus-prometheus.yaml <span class="token punctuation">\</span>
  node-exporter/node-exporter-daemonset.yaml
<span class="token punctuation">[</span>root@master55 prometheus<span class="token punctuation">]</span><span class="token comment">#</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ol start="8"><li>注意：镜像使用dockerhub上的</li></ol> <div class="language-shell script line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@master55 prometheus<span class="token punctuation">]</span><span class="token comment"># find -type f -exec sed -ri &amp;#39;s#k8s.gcr.io#gcr.azk8s.cn/google_containers#&amp;#39; {} \; </span>
<span class="token punctuation">[</span>root@master55 prometheus<span class="token punctuation">]</span><span class="token comment">#</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ol start="9"><li>生成namespace</li></ol> <div class="language-shell script line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@master55 prometheus<span class="token punctuation">]</span><span class="token comment"># kubectl apply -f .</span>
namespace/monitoring created
<span class="token punctuation">[</span>root@master55 prometheus<span class="token punctuation">]</span><span class="token comment">#</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ol start="10"><li>安装operater</li></ol> <div class="language-shell script line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@master55 prometheus<span class="token punctuation">]</span><span class="token comment"># kubectl apply -f operator/</span>
customresourcedefinition.apiextensions.k8s.io/alertmanagers.monitoring.coreos.com created
customresourcedefinition.apiextensions.k8s.io/podmonitors.monitoring.coreos.com created
customresourcedefinition.apiextensions.k8s.io/prometheuses.monitoring.coreos.com created
customresourcedefinition.apiextensions.k8s.io/prometheusrules.monitoring.coreos.com created
customresourcedefinition.apiextensions.k8s.io/servicemonitors.monitoring.coreos.com created
customresourcedefinition.apiextensions.k8s.io/thanosrulers.monitoring.coreos.com created
clusterrole.rbac.authorization.k8s.io/prometheus-operator created
clusterrolebinding.rbac.authorization.k8s.io/prometheus-operator created
deployment.apps/prometheus-operator created
service/prometheus-operator created
serviceaccount/prometheus-operator created
<span class="token punctuation">[</span>root@master55 prometheus<span class="token punctuation">]</span><span class="token comment">#</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><ol start="11"><li>依次安装其他组件</li></ol> <div class="language-shell script line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@master55 prometheus<span class="token punctuation">]</span><span class="token comment"># kubectl apply -f adapter/</span>
<span class="token punctuation">[</span>root@master55 prometheus<span class="token punctuation">]</span><span class="token comment"># kubectl apply -f alertmanager/</span>
<span class="token punctuation">[</span>root@master55 prometheus<span class="token punctuation">]</span><span class="token comment"># kubectl apply -f node-exporter/</span>
<span class="token punctuation">[</span>root@master55 prometheus<span class="token punctuation">]</span><span class="token comment"># kubectl apply -f kube-state-metrics/</span>
<span class="token punctuation">[</span>root@master55 prometheus<span class="token punctuation">]</span><span class="token comment"># kubectl apply -f grafana/</span>
<span class="token punctuation">[</span>root@master55 prometheus<span class="token punctuation">]</span><span class="token comment"># kubectl apply -f prometheus/</span>
<span class="token punctuation">[</span>root@master55 prometheus<span class="token punctuation">]</span><span class="token comment"># kubectl apply -f serviceMonitor/</span>
<span class="token punctuation">[</span>root@master55 prometheus<span class="token punctuation">]</span><span class="token comment">#</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><ol start="12"><li>查看整体状态</li></ol> <div class="language-shell script line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@master55 /<span class="token punctuation">]</span><span class="token comment"># kubectl -n monitoring get all</span>
NAME                                       READY   STATUS    RESTARTS   AGE
pod/alertmanager-main-0                    <span class="token number">2</span>/2     Running   <span class="token number">0</span>          28m
pod/alertmanager-main-1                    <span class="token number">2</span>/2     Running   <span class="token number">0</span>          28m
pod/alertmanager-main-2                    <span class="token number">2</span>/2     Running   <span class="token number">0</span>          28m
pod/grafana-5c55845445-hzhbk               <span class="token number">1</span>/1     Running   <span class="token number">0</span>          38m
pod/kube-state-metrics-665c856fb9-7ggrg    <span class="token number">3</span>/3     Running   <span class="token number">0</span>          38m
pod/node-exporter-dqfd7                    <span class="token number">2</span>/2     Running   <span class="token number">0</span>          39m
pod/node-exporter-gf8gr                    <span class="token number">2</span>/2     Running   <span class="token number">0</span>          39m
pod/node-exporter-mcl79                    <span class="token number">2</span>/2     Running   <span class="token number">0</span>          39m
pod/prometheus-adapter-5cdcdf9c8d-665fj    <span class="token number">1</span>/1     Running   <span class="token number">0</span>          39m
pod/prometheus-operator-6f98f66b89-6spkk   <span class="token number">2</span>/2     Running   <span class="token number">0</span>          32m

NAME                            TYPE        CLUSTER-IP       EXTERNAL-IP   PORT<span class="token punctuation">(</span>S<span class="token punctuation">)</span>                      AGE
service/alertmanager-main       ClusterIP   <span class="token number">10.111</span>.117.158   <span class="token operator">&amp;</span>lt<span class="token punctuation">;</span>none<span class="token operator">&amp;</span>gt<span class="token punctuation">;</span>        <span class="token number">9093</span>/TCP                     39m
service/alertmanager-operated   ClusterIP   None             <span class="token operator">&amp;</span>lt<span class="token punctuation">;</span>none<span class="token operator">&amp;</span>gt<span class="token punctuation">;</span>        <span class="token number">9093</span>/TCP,9094/TCP,9094/UDP   28m
service/grafana                 ClusterIP   <span class="token number">10.111</span>.25.63     <span class="token operator">&amp;</span>lt<span class="token punctuation">;</span>none<span class="token operator">&amp;</span>gt<span class="token punctuation">;</span>        <span class="token number">3000</span>/TCP                     38m
service/kube-state-metrics      ClusterIP   None             <span class="token operator">&amp;</span>lt<span class="token punctuation">;</span>none<span class="token operator">&amp;</span>gt<span class="token punctuation">;</span>        <span class="token number">8443</span>/TCP,9443/TCP            38m
service/node-exporter           ClusterIP   None             <span class="token operator">&amp;</span>lt<span class="token punctuation">;</span>none<span class="token operator">&amp;</span>gt<span class="token punctuation">;</span>        <span class="token number">9100</span>/TCP                     39m
service/prometheus-adapter      ClusterIP   <span class="token number">10.109</span>.99.195    <span class="token operator">&amp;</span>lt<span class="token punctuation">;</span>none<span class="token operator">&amp;</span>gt<span class="token punctuation">;</span>        <span class="token number">443</span>/TCP                      39m
service/prometheus-k8s          ClusterIP   <span class="token number">10.110</span>.243.126   <span class="token operator">&amp;</span>lt<span class="token punctuation">;</span>none<span class="token operator">&amp;</span>gt<span class="token punctuation">;</span>        <span class="token number">9090</span>/TCP                     38m
service/prometheus-operator     ClusterIP   None             <span class="token operator">&amp;</span>lt<span class="token punctuation">;</span>none<span class="token operator">&amp;</span>gt<span class="token punctuation">;</span>        <span class="token number">8443</span>/TCP                     32m

NAME                           DESIRED   CURRENT   READY   UP-TO-DATE   AVAILABLE   NODE SELECTOR                 AGE
daemonset.apps/node-exporter   <span class="token number">3</span>         <span class="token number">3</span>         <span class="token number">3</span>       <span class="token number">3</span>            <span class="token number">3</span>           beta.kubernetes.io/os<span class="token operator">=</span>linux   39m

NAME                                  READY   UP-TO-DATE   AVAILABLE   AGE
deployment.apps/grafana               <span class="token number">1</span>/1     <span class="token number">1</span>            <span class="token number">1</span>           38m
deployment.apps/kube-state-metrics    <span class="token number">1</span>/1     <span class="token number">1</span>            <span class="token number">1</span>           38m
deployment.apps/prometheus-adapter    <span class="token number">1</span>/1     <span class="token number">1</span>            <span class="token number">1</span>           39m
deployment.apps/prometheus-operator   <span class="token number">1</span>/1     <span class="token number">1</span>            <span class="token number">1</span>           32m

NAME                                             DESIRED   CURRENT   READY   AGE
replicaset.apps/grafana-5c55845445               <span class="token number">1</span>         <span class="token number">1</span>         <span class="token number">1</span>       38m
replicaset.apps/kube-state-metrics-665c856fb9    <span class="token number">1</span>         <span class="token number">1</span>         <span class="token number">1</span>       38m
replicaset.apps/prometheus-adapter-5cdcdf9c8d    <span class="token number">1</span>         <span class="token number">1</span>         <span class="token number">1</span>       39m
replicaset.apps/prometheus-operator-6f98f66b89   <span class="token number">1</span>         <span class="token number">1</span>         <span class="token number">1</span>       32m

NAME                                 READY   AGE
statefulset.apps/alertmanager-main   <span class="token number">3</span>/3     28m
<span class="token punctuation">[</span>root@master55 /<span class="token punctuation">]</span><span class="token comment">#</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br></div></div><ol start="13"><li>k8s查看所有svc</li></ol> <div class="language-shell script line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@master55 prometheus<span class="token punctuation">]</span><span class="token comment"># kubectl -n monitoring get svc</span>
NAME                    TYPE        CLUSTER-IP       EXTERNAL-IP   PORT<span class="token punctuation">(</span>S<span class="token punctuation">)</span>                      AGE
alertmanager-main       ClusterIP   <span class="token number">10.111</span>.117.158   <span class="token operator">&amp;</span>lt<span class="token punctuation">;</span>none<span class="token operator">&amp;</span>gt<span class="token punctuation">;</span>        <span class="token number">9093</span>/TCP                     115m
alertmanager-operated   ClusterIP   None             <span class="token operator">&amp;</span>lt<span class="token punctuation">;</span>none<span class="token operator">&amp;</span>gt<span class="token punctuation">;</span>        <span class="token number">9093</span>/TCP,9094/TCP,9094/UDP   104m
grafana                 NodePort    <span class="token number">10.111</span>.25.63     <span class="token operator">&amp;</span>lt<span class="token punctuation">;</span>none<span class="token operator">&amp;</span>gt<span class="token punctuation">;</span>        <span class="token number">3000</span>:31533/TCP               114m
kube-state-metrics      ClusterIP   None             <span class="token operator">&amp;</span>lt<span class="token punctuation">;</span>none<span class="token operator">&amp;</span>gt<span class="token punctuation">;</span>        <span class="token number">8443</span>/TCP,9443/TCP            115m
node-exporter           ClusterIP   None             <span class="token operator">&amp;</span>lt<span class="token punctuation">;</span>none<span class="token operator">&amp;</span>gt<span class="token punctuation">;</span>        <span class="token number">9100</span>/TCP                     115m
prometheus-adapter      ClusterIP   <span class="token number">10.109</span>.99.195    <span class="token operator">&amp;</span>lt<span class="token punctuation">;</span>none<span class="token operator">&amp;</span>gt<span class="token punctuation">;</span>        <span class="token number">443</span>/TCP                      115m
prometheus-k8s          ClusterIP   <span class="token number">10.110</span>.243.126   <span class="token operator">&amp;</span>lt<span class="token punctuation">;</span>none<span class="token operator">&amp;</span>gt<span class="token punctuation">;</span>        <span class="token number">9090</span>/TCP                     114m
prometheus-operator     ClusterIP   None             <span class="token operator">&amp;</span>lt<span class="token punctuation">;</span>none<span class="token operator">&amp;</span>gt<span class="token punctuation">;</span>        <span class="token number">8443</span>/TCP                     108m
<span class="token punctuation">[</span>root@master55 prometheus<span class="token punctuation">]</span><span class="token comment">#</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><ol start="13"><li>k8s暴露grafana外网访问端口
修改type: ClusterIP为 type: NodePort ,默认外网端口NodePort对应的是31533，找到如下代码，</li></ol> <div class="language-shell script line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@master55 prometheus<span class="token punctuation">]</span><span class="token comment"># kubectl -n monitoring edit svc grafana</span>

spec:
  clusterIP: <span class="token number">10.111</span>.25.63
  externalTrafficPolicy: Cluster
  ports:
  - name: http
    nodePort: <span class="token number">31533</span>
    port: <span class="token number">3000</span>
    protocol: TCP
    targetPort: http
  selector:
    app: grafana
  sessionAffinity: None
  type: NodePort

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><ol start="14"><li>最终效果图（部分效果图）</li></ol> <p><img src="https://cdn.jsdelivr.net/gh/xincan/blog-database/blog/centos-k8s-5.png" alt="效果图一"> <img src="https://cdn.jsdelivr.net/gh/xincan/blog-database/blog/centos-k8s-4.png" alt="效果图一"> <img src="https://cdn.jsdelivr.net/gh/xincan/blog-database/blog/centos-k8s-3.png" alt="效果图一"></p> <h4 id="十九、-安装kubernetes-dashboard"><a href="#十九、-安装kubernetes-dashboard" class="header-anchor">#</a> 十九、 安装kubernetes-dashboard</h4> <p>下载dashboard所需资源
git clone https://github.com/xincan/kubernetes.git</p> <div class="language-shell script line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@xincan /<span class="token punctuation">]</span><span class="token comment">#cd /k8s/</span>
<span class="token punctuation">[</span>root@xincan k8s<span class="token punctuation">]</span><span class="token comment">#git clone https://github.com/xincan/kubernetes.git</span>
<span class="token punctuation">[</span>root@xincan k8s<span class="token punctuation">]</span><span class="token comment">#ls</span>
calico  kube-prometheus  kubernetes-dashboard  prometheus
<span class="token punctuation">[</span>root@master55 k8s<span class="token punctuation">]</span><span class="token comment"># cd kubernetes-dashboard/</span>
<span class="token punctuation">[</span>root@master55 kubernetes-dashboard<span class="token punctuation">]</span><span class="token comment"># ls</span>
login-token  recommended.yaml
<span class="token punctuation">[</span>root@master55 kubernetes-dashboard<span class="token punctuation">]</span><span class="token comment">#kubectl create -f recommended.yaml</span>
namespace/kubernetes-dashboard created
serviceaccount/kubernetes-dashboard created
service/kubernetes-dashboard created
secret/kubernetes-dashboard-certs created
secret/kubernetes-dashboard-csrf created
secret/kubernetes-dashboard-key-holder created
configmap/kubernetes-dashboard-settings created
role.rbac.authorization.k8s.io/kubernetes-dashboard created
clusterrole.rbac.authorization.k8s.io/kubernetes-dashboard created
rolebinding.rbac.authorization.k8s.io/kubernetes-dashboard created
clusterrolebinding.rbac.authorization.k8s.io/kubernetes-dashboard created
deployment.apps/kubernetes-dashboard created
service/dashboard-metrics-scraper created
deployment.apps/dashboard-metrics-scraper created
<span class="token punctuation">[</span>root@master55 kubernetes-dashboard<span class="token punctuation">]</span><span class="token comment">#</span>
<span class="token comment">## 查看kubernetes-dashboard命名空间下pod，svc</span>
<span class="token punctuation">[</span>root@master55 kubernetes-dashboard<span class="token punctuation">]</span><span class="token comment"># kubectl get pod,svc -n kubernetes-dashboard</span>
NAME                                             READY   STATUS              RESTARTS   AGE
pod/dashboard-metrics-scraper-779f5454cb-hzgc4   <span class="token number">1</span>/1     ContainerCreating   <span class="token number">0</span>          30s
pod/kubernetes-dashboard-857bb4c778-gsf2q        <span class="token number">1</span>/1     ContainerCreating   <span class="token number">0</span>          30s

NAME                                TYPE        CLUSTER-IP      EXTERNAL-IP   PORT<span class="token punctuation">(</span>S<span class="token punctuation">)</span>    AGE
service/dashboard-metrics-scraper   ClusterIP   <span class="token number">10.105</span>.54.169   <span class="token operator">&amp;</span>lt<span class="token punctuation">;</span>none<span class="token operator">&amp;</span>gt<span class="token punctuation">;</span>        <span class="token number">8000</span>/TCP   30s
service/kubernetes-dashboard        ClusterIP   <span class="token number">10.110</span>.40.170   <span class="token operator">&amp;</span>lt<span class="token punctuation">;</span>none<span class="token operator">&amp;</span>gt<span class="token punctuation">;</span>        <span class="token number">443</span>/TCP    31s
<span class="token punctuation">[</span>root@master55 kubernetes-dashboard<span class="token punctuation">]</span><span class="token comment">#</span>
<span class="token comment">## 增加nodePort: 30001,设置dashboard访问端口，修改type: NodePort,保存退出自动更新</span>
<span class="token comment">## 也可以使用kubectl patch svc -n kube-system kubernetes-dashboard -p &amp;#39;{&amp;quot;spec&amp;quot;:{&amp;quot;type&amp;quot;:&amp;quot;NodePort&amp;quot;}}&amp;#39;进行修改</span>
<span class="token punctuation">[</span>root@master55 kubernetes-dashboard<span class="token punctuation">]</span><span class="token comment">#kubectl edit svc -n kubernetes-dashboard kubernetes-dashboard</span>
spec:
  clusterIP: <span class="token number">10.110</span>.40.170
  externalTrafficPolicy: Cluster
  ports:
  - nodePort: <span class="token number">30000</span>
    port: <span class="token number">443</span>
    protocol: TCP
    targetPort: <span class="token number">8443</span>
  selector:
    k8s-app: kubernetes-dashboard
  sessionAffinity: None
  type: NodePort

dit cancelled, no changes made.
<span class="token comment">## 修改完成后，可以看到kubernetes-dashboard的type为NodePort，端口为30000</span>
<span class="token punctuation">[</span>root@master55 kubernetes-dashboard<span class="token punctuation">]</span><span class="token comment"># kubectl get svc -n kubernetes-dashboard kubernetes-dashboard</span>
NAME                   TYPE       CLUSTER-IP      EXTERNAL-IP   PORT<span class="token punctuation">(</span>S<span class="token punctuation">)</span>         AGE
kubernetes-dashboard   NodePort   <span class="token number">10.110</span>.40.170   <span class="token operator">&amp;</span>lt<span class="token punctuation">;</span>none<span class="token operator">&amp;</span>gt<span class="token punctuation">;</span>        <span class="token number">443</span>:30001/TCP   14m
<span class="token punctuation">[</span>root@master55 kubernetes-dashboard<span class="token punctuation">]</span><span class="token comment">#</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br></div></div><h4 id="二十、-token令牌登录"><a href="#二十、-token令牌登录" class="header-anchor">#</a> 二十、 Token令牌登录</h4> <div class="language-shell script line-numbers-mode"><pre class="language-shell"><code><span class="token comment">## 在kube-system命名空间下创建xincan-dashboard-admin用户</span>
<span class="token punctuation">[</span>root@master55 k8s<span class="token punctuation">]</span><span class="token comment"># kubectl create serviceaccount xincan-dashboard-admin -n kube-system</span>
serviceaccount/xincan-dashboard-admin created
<span class="token comment">## 查看用户</span>
<span class="token punctuation">[</span>root@master55 k8s<span class="token punctuation">]</span><span class="token comment"># kubectl get serviceaccount xincan-dashboard-admin -n kube-system</span>
NAME                     SECRETS   AGE
xincan-dashboard-admin   <span class="token number">1</span>         7s
<span class="token punctuation">[</span>root@master55 k8s<span class="token punctuation">]</span><span class="token comment">#</span>

<span class="token comment">## 在kube-system命名空间下，创建xincan-dashboard-admin权限</span>
<span class="token punctuation">[</span>root@master55 k8s<span class="token punctuation">]</span><span class="token comment"># kubectl create clusterrolebinding dashboard-cluster-admin --clusterrole=cluster-admin --serviceaccount=kube-system:xincan-dashboard-admin</span>
clusterrolebinding.rbac.authorization.k8s.io/dashboard-cluster-admin created

<span class="token comment">## 查看权限xincan-dashboard-admin是否生效</span>
<span class="token punctuation">[</span>root@master55 k8s<span class="token punctuation">]</span><span class="token comment"># kubectl get secret -n kube-system</span>
NAME                                             TYPE                                  DATA   AGE
attachdetach-controller-token-fk6c9              kubernetes.io/service-account-token   <span class="token number">3</span>      91m
bootstrap-signer-token-kjw62                     kubernetes.io/service-account-token   <span class="token number">3</span>      91m
bootstrap-token-90s06v                           bootstrap.kubernetes.io/token         <span class="token number">7</span>      91m
calico-kube-controllers-token-6824q              kubernetes.io/service-account-token   <span class="token number">3</span>      85m
calico-node-token-22rkl                          kubernetes.io/service-account-token   <span class="token number">3</span>      85m
certificate-controller-token-4zhbc               kubernetes.io/service-account-token   <span class="token number">3</span>      91m
clusterrole-aggregation-controller-token-vzbqs   kubernetes.io/service-account-token   <span class="token number">3</span>      91m
coredns-token-xrqs4                              kubernetes.io/service-account-token   <span class="token number">3</span>      91m
xincan-dashboard-admin-token-jkhl2               kubernetes.io/service-account-token   <span class="token number">3</span>      3m35s
<span class="token punctuation">[</span>root@master55 k8s<span class="token punctuation">]</span><span class="token comment">#</span>

<span class="token comment">## 获取xincan-dashboard-admin-token-jkhl2的token令牌</span>
<span class="token punctuation">[</span>root@master55 k8s<span class="token punctuation">]</span><span class="token comment"># kubectl describe secret -n kube-system xincan-dashboard-admin-token-jkhl2</span>
Name:         xincan-dashboard-admin-token-jkhl2
Namespace:    kube-system
Labels:       <span class="token operator">&amp;</span>lt<span class="token punctuation">;</span>none<span class="token operator">&amp;</span>gt<span class="token punctuation">;</span>
Annotations:  kubernetes.io/service-account.name: xincan-dashboard-admin
              kubernetes.io/service-account.uid: c257c2f8-57cf-41d7-b8e6-b833a8ef0790

Type:  kubernetes.io/service-account-token

Data
<span class="token operator">==</span><span class="token operator">==</span>
ca.crt:     <span class="token number">1025</span> bytes
namespace:  <span class="token number">11</span> bytes
token:      eyJhbGciOiJSUzI1NiIsImtpZCI6IkFfZDQ5YTBkcTIwVG1xdF9rWFJxWDJfblFMd1lfdWQwdllVVjFxZTVtcTQifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlLXN5c3RlbSIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJ4aW5jYW4tZGFzaGJvYXJkLWFkbWluLXRva2VuLWpraGwyIiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQubmFtZSI6InhpbmNhbi1kYXNoYm9hcmQtYWRtaW4iLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC51aWQiOiJjMjU3YzJmOC01N2NmLTQxZDctYjhlNi1iODMzYThlZjA3OTAiLCJzdWIiOiJzeXN0ZW06c2VydmljZWFjY291bnQ6a3ViZS1zeXN0ZW06eGluY2FuLWRhc2hib2FyZC1hZG1pbiJ9.rPDqRpuVrQmTXJ7FHKz8isG4IqYs7aN5QgZCLVRLK1Ul0677pmPfFTgZpVzf5R9f6_h7kFLGFej9wq5QJ3NZn71jv1qhn9rYgabyZ9KsDZsE6SDwQQuHcVDz7iQ9prFezyqdiyBIxqoFEFhZyZe8pn-Ua53a7-P4Dm2xs2xMgbvrLt6b_b8--H_plV-6xrLKrM5BhG15HDi5MA7MXBZJzxTyuNC8CtjQ6ShuQFv5I3Fwqgugu9tqxGBk9Xjy82JGrdnvoSNRNThCMzlVZmClzrsT6CZ4BUw4t0x4dYhvbdo6IS5nnW0u_EOsaDdi1gqBjpeMX_tNT1ChqN55TnnPPw
<span class="token punctuation">[</span>root@master55 k8s<span class="token punctuation">]</span><span class="token comment">#</span>
<span class="token comment">## 复制令牌然后到登录界面进行粘贴</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br></div></div><p><img src="https://cdn.jsdelivr.net/gh/xincan/blog-database/blog/k8s-token-login.png" alt="token登录方式"></p> <h4 id="二十、-kubeconfig登录"><a href="#二十、-kubeconfig登录" class="header-anchor">#</a> 二十、 KubeConfig登录</h4> <div class="language-shell script line-numbers-mode"><pre class="language-shell"><code>
<span class="token punctuation">[</span>root@master55 k8s<span class="token punctuation">]</span><span class="token comment"># DASH_TOCKEN=$(kubectl get secret -n kube-system xincan-dashboard-admin-token-jkhl2 -o jsonpath={.data.token}|base64 -d)</span>
<span class="token punctuation">[</span>root@master55 k8s<span class="token punctuation">]</span><span class="token comment"># kubectl config set-cluster kubernetes --server=https://kubernetes.docker.internal:6443 --kubeconfig=/k8s/xincan-dashbord-admin.conf</span>
Cluster <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>kubernetes<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span> set.
<span class="token punctuation">[</span>root@master55 k8s<span class="token punctuation">]</span><span class="token comment"># kubectl config set-credentials xincan-dashboard-admin --token=$DASH_TOCKEN --kubeconfig=/k8s/xincan-dashbord-admin.conf</span>
User <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>xincan-dashboard-admin<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span> set.
<span class="token punctuation">[</span>root@master55 k8s<span class="token punctuation">]</span><span class="token comment"># kubectl config set-context dashboard-admin@kubernetes --cluster=kubernetes --user=xincan-dashboard-admin --kubeconfig=/k8s/xincan-dashbord-admin.conf</span>
Context <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>dashboard-admin@kubernetes<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span> created.
<span class="token punctuation">[</span>root@master55 k8s<span class="token punctuation">]</span><span class="token comment"># kubectl config use-context dashboard-admin@kubernetes --kubeconfig=/k8s/xincan-dashbord-admin.conf</span>
Switched to context <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>dashboard-admin@kubernetes<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token builtin class-name">.</span>
<span class="token punctuation">[</span>root@master55 k8s<span class="token punctuation">]</span><span class="token comment"># ll</span>
total <span class="token number">710420</span>
-rw-r--r-- <span class="token number">1</span> root root     <span class="token number">21079</span> Jul <span class="token number">12</span> <span class="token number">22</span>:24 calico-3.13.1.yaml
-rwxr-xr-x <span class="token number">1</span> root root      <span class="token number">2051</span> Jul <span class="token number">16</span> <span class="token number">14</span>:40 get-k8s-images.sh
-rw-r--r-- <span class="token number">1</span> root root <span class="token number">727422976</span> Jul <span class="token number">16</span> <span class="token number">14</span>:57 k8s-imagesV1.18.5.tar
-rw-r--r-- <span class="token number">1</span> root root       <span class="token number">901</span> Jul <span class="token number">16</span> <span class="token number">15</span>:54 k8s-token
drwxr-xr-x <span class="token number">3</span> root root      <span class="token number">4096</span> Jul <span class="token number">16</span> <span class="token number">17</span>:47 kube-prometheus
drwxr-xr-x <span class="token number">2</span> root root        <span class="token number">30</span> Jul <span class="token number">16</span> <span class="token number">17</span>:47 kubernetes-dashboard
-rw------- <span class="token number">1</span> root root      <span class="token number">1321</span> Jul <span class="token number">16</span> <span class="token number">17</span>:01 xincan-dashbord-admin.conf
<span class="token punctuation">[</span>root@master55 k8s<span class="token punctuation">]</span><span class="token comment">#</span>

<span class="token comment">## 将生成后的xincan-dashbord-admin.conf复制到登录的主机，在需要时，上传这个配置文件即可</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p><img src="https://cdn.jsdelivr.net/gh/xincan/blog-database/blog/k8s-kubeconfig-login.png" alt="token登录方式"></p> <p><img src="https://cdn.jsdelivr.net/gh/xincan/blog-database/blog/k8s-main.png" alt="kubernetes主界面"></p></div> <footer class="page-edit" style="display:none;"><!----> <!----></footer> <!----> <!----></main> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-a008c6ba data-v-a008c6ba><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-a008c6ba><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-a008c6ba></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-a008c6ba></path></svg></div><div class="kanbanniang" data-v-ee8d62e6><div class="banniang-container" style="display:;" data-v-ee8d62e6><div class="messageBox" style="right:68px;bottom:190px;display:none;" data-v-ee8d62e6>
      欢迎来到 jun的个人空间
    </div> <div class="operation" style="right:90px;bottom:40px;display:;" data-v-ee8d62e6><i class="kbnfont kbn-ban-home ban-home" data-v-ee8d62e6></i> <i class="kbnfont kbn-ban-message message" data-v-ee8d62e6></i> <i class="kbnfont kbn-ban-close close" data-v-ee8d62e6></i> <a target="_blank" href="https://vuepress-theme-reco.recoluan.com/views/plugins/kanbanniang.html" data-v-ee8d62e6><i class="kbnfont kbn-ban-info info" data-v-ee8d62e6></i></a> <i class="kbnfont kbn-ban-theme skin" style="display:none;" data-v-ee8d62e6></i></div> <canvas id="banniang" width="150" height="220" class="live2d" style="position:fixed;left:0px;bottom:0px;opacity:0.9;z-index:99999;" data-v-ee8d62e6></canvas></div> <div class="showBanNiang" style="display:none;" data-v-ee8d62e6>
    看板娘
  </div></div><canvas id="vuepress-canvas-cursor"></canvas></div></div>
    <script src="/blog/assets/js/app.99c65bc6.js" defer></script><script src="/blog/assets/js/3.859d6461.js" defer></script><script src="/blog/assets/js/1.8f7e9fb3.js" defer></script><script src="/blog/assets/js/16.06f3b591.js" defer></script>
  </body>
</html>
